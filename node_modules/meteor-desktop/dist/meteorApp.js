'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _setImmediate2 = require('babel-runtime/core-js/set-immediate');

var _setImmediate3 = _interopRequireDefault(_setImmediate2);

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _assign = require('babel-runtime/core-js/object/assign');

var _assign2 = _interopRequireDefault(_assign);

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _crossSpawn = require('cross-spawn');

var _crossSpawn2 = _interopRequireDefault(_crossSpawn);

var _semver = require('semver');

var _semver2 = _interopRequireDefault(_semver);

var _shelljs = require('shelljs');

var _shelljs2 = _interopRequireDefault(_shelljs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _singleLineLog = require('single-line-log');

var _singleLineLog2 = _interopRequireDefault(_singleLineLog);

var _asar = require('asar');

var _asar2 = _interopRequireDefault(_asar);

var _nodeFetch = require('node-fetch');

var _nodeFetch2 = _interopRequireDefault(_nodeFetch);

var _isDesktopInjector = require('../skeleton/modules/autoupdate/isDesktopInjector');

var _isDesktopInjector2 = _interopRequireDefault(_isDesktopInjector);

var _log = require('./log');

var _log2 = _interopRequireDefault(_log);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var join = _path2.default.join;

var sll = _singleLineLog2.default.stdout;

// TODO: refactor all strategy ifs to one place

/**
 * Represents the Meteor app.
 * @property {MeteorDesktop} $
 * @class
 */

var MeteorApp = function () {

    /**
     * @param {MeteorDesktop} $ - context
     * @constructor
     */
    function MeteorApp($) {
        (0, _classCallCheck3.default)(this, MeteorApp);

        this.log = new _log2.default('meteorApp');
        this.$ = $;
        this.mobilePlatform = null;
        this.oldManifest = null;
        this.injector = new _isDesktopInjector2.default();
        this.matcher = new RegExp('__meteor_runtime_config__ = JSON.parse\\(decodeURIComponent\\("([^"]*)"\\)\\)');
        this.replacer = new RegExp('(__meteor_runtime_config__ = JSON.parse\\(decodeURIComponent\\()"([^"]*)"(\\)\\))');
        this.meteorVersion = null;
        this.indexHTMLstrategy = null;

        this.indexHTMLStrategies = {
            INDEX_FROM_CORDOVA_BUILD: 1,
            INDEX_FROM_RUNNING_SERVER: 2
        };
    }

    /**
     * Looks for specified packages in .meteor/packages. In other words checks if the project has
     * specified packages added.
     * @param {Array} packages
     * @returns {boolean}
     */


    (0, _createClass3.default)(MeteorApp, [{
        key: 'checkPackages',
        value: function checkPackages(packages) {
            var usedPackages = _fs2.default.readFileSync(this.$.env.paths.meteorApp.packages, 'UTF-8').split('\n');
            return !packages.some(function (packageToFind) {
                return !usedPackages.some(function (meteorPackage) {
                    return ~meteorPackage.indexOf(packageToFind);
                });
            });
        }

        /**
         * Looks for specified packages in .meteor/packages. In other words checks if the project has
         * specified packages added.
         * @param {Array} packages
         * @returns {boolean}
         */

    }, {
        key: 'checkPackagesVersion',
        value: function checkPackagesVersion(packages) {
            var usedPackages = _fs2.default.readFileSync(this.$.env.paths.meteorApp.versions, 'UTF-8').split('\n');
            return !packages.some(function (packageToFind) {
                return !usedPackages.some(function (meteorPackage) {
                    return meteorPackage === packageToFind;
                });
            });
        }

        /**
         * Ensures certain packages are added to meteor project and in correct version.
         * @param {Array} packages
         * @param {Array} packagesWithVersion
         * @param {string} who - name of the entity that requests presence of thos packages (can be the
         *                       integration itself or a plugin)
         * @returns {Promise.<void>}
         */

    }, {
        key: 'ensurePackages',
        value: function () {
            var _ref = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(packages, packagesWithVersion, who) {
                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                if (this.checkPackages(packages)) {
                                    _context.next = 10;
                                    break;
                                }

                                this.log.warn(who + ' requires some packages that are not added to project, will try to add them now');
                                _context.prev = 2;
                                _context.next = 5;
                                return this.addPackages(packages, packagesWithVersion);

                            case 5:
                                _context.next = 10;
                                break;

                            case 7:
                                _context.prev = 7;
                                _context.t0 = _context['catch'](2);
                                throw new Error(_context.t0);

                            case 10:
                                if (this.checkPackagesVersion(packagesWithVersion)) {
                                    _context.next = 20;
                                    break;
                                }

                                this.log.warn(who + ' required packages version is different, fixing it');
                                _context.prev = 12;
                                _context.next = 15;
                                return this.addPackages(packages, packagesWithVersion);

                            case 15:
                                _context.next = 20;
                                break;

                            case 17:
                                _context.prev = 17;
                                _context.t1 = _context['catch'](12);
                                throw new Error(_context.t1);

                            case 20:
                            case 'end':
                                return _context.stop();
                        }
                    }
                }, _callee, this, [[2, 7], [12, 17]]);
            }));

            function ensurePackages(_x, _x2, _x3) {
                return _ref.apply(this, arguments);
            }

            return ensurePackages;
        }()

        /**
         * Ensures that required packages are added to the Meteor app.
         */

    }, {
        key: 'ensureDesktopHCPPackages',
        value: function () {
            var _ref2 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee2() {
                var _this = this;

                var packages, packagesWithVersion;
                return _regenerator2.default.wrap(function _callee2$(_context2) {
                    while (1) {
                        switch (_context2.prev = _context2.next) {
                            case 0:
                                if (!this.$.desktop.getSettings().desktopHCP) {
                                    _context2.next = 14;
                                    break;
                                }

                                this.log.verbose('desktopHCP is enabled, checking for required packages');

                                packages = ['omega:meteor-desktop-watcher', 'omega:meteor-desktop-bundler'];
                                packagesWithVersion = packages.map(function (packageName) {
                                    return packageName + '@' + _this.$.getVersion();
                                });
                                _context2.prev = 4;
                                _context2.next = 7;
                                return this.ensurePackages(packages, packagesWithVersion, 'desktopHCP');

                            case 7:
                                _context2.next = 12;
                                break;

                            case 9:
                                _context2.prev = 9;
                                _context2.t0 = _context2['catch'](4);
                                throw new Error(_context2.t0);

                            case 12:
                                _context2.next = 15;
                                break;

                            case 14:
                                this.log.verbose('desktopHCP is not enabled, skipping checking for required packages');

                            case 15:
                            case 'end':
                                return _context2.stop();
                        }
                    }
                }, _callee2, this, [[4, 9]]);
            }));

            function ensureDesktopHCPPackages() {
                return _ref2.apply(this, arguments);
            }

            return ensureDesktopHCPPackages;
        }()

        /**
         * Adds packages to the meteor app.
         * @param {Array} packages            - array with names of the packages to add
         * @param {Array} packagesWithVersion - array with names and versions of the packages to add
         */

    }, {
        key: 'addPackages',
        value: function addPackages(packages, packagesWithVersion) {
            var _this2 = this;

            this.log.info('adding packages to meteor project', packagesWithVersion);
            return new _promise2.default(function (resolve, reject) {
                (0, _crossSpawn2.default)('meteor', ['add'].concat(packagesWithVersion.map(function (packageName) {
                    return packageName.replace('@', '@=');
                })), {
                    cwd: _this2.$.env.paths.meteorApp.root,
                    stdio: ['pipe', 'pipe', process.stderr],
                    env: (0, _assign2.default)({ METEOR_PRETTY_OUTPUT: 0, METEOR_NO_RELEASE_CHECK: 1 }, process.env)
                }).on('exit', function (code) {
                    if (code !== 0 || !_this2.checkPackages(packages)) {
                        reject('adding packages failed');
                    } else {
                        resolve();
                    }
                });
            });
        }

        /**
         * Adds entry to .meteor/.gitignore if necessary.
         */

    }, {
        key: 'updateGitIgnore',
        value: function updateGitIgnore() {
            this.log.verbose('updating .meteor/.gitignore');
            // Lets read the .meteor/.gitignore and filter out blank lines.
            var gitIgnore = _fs2.default.readFileSync(this.$.env.paths.meteorApp.gitIgnore, 'UTF-8').split('\n').filter(function (ignoredPath) {
                return ignoredPath.trim() !== '';
            });

            if (!~gitIgnore.indexOf(this.$.env.paths.electronApp.rootName)) {
                this.log.verbose('adding ' + this.$.env.paths.electronApp.rootName + ' to .meteor/.gitignore');
                gitIgnore.push(this.$.env.paths.electronApp.rootName);

                _fs2.default.writeFileSync(this.$.env.paths.meteorApp.gitIgnore, gitIgnore.join('\n'), 'UTF-8');
            }
        }

        /**
         * Reads the Meteor release version used in the app.
         * @returns {string}
         */

    }, {
        key: 'getMeteorRelease',
        value: function getMeteorRelease() {
            var release = _fs2.default.readFileSync(this.$.env.paths.meteorApp.release, 'UTF-8').split('\n')[0];
            release = release.split('@')[1];
            // We do not care if it is beta.
            if (~release.indexOf('-')) {
                release = release.split('-')[0];
            }
            return release;
        }

        /**
         * Validate meteor version against a versionRange.
         * @param {string} versionRange - semver version range
         */

    }, {
        key: 'checkMeteorVersion',
        value: function checkMeteorVersion(versionRange) {
            var release = this.getMeteorRelease();
            release = release.match(/(^\d+\.\d+\.\d+)/gmi)[0];
            if (!_semver2.default.satisfies(release, versionRange)) {
                if (this.$.env.options.skipMobileBuild) {
                    this.log.error('wrong meteor version (' + release + ') in project - only ' + (versionRange + ' is supported'));
                } else {
                    this.log.error('wrong meteor version (' + release + ') in project - only ' + (versionRange + ' is supported for automatic meteor builds (you can always ') + 'try with `--skip-mobile-build` if you are using meteor >= 1.2.1');
                }
                process.exit(1);
            }
        }

        /**
         * Decides which strategy to use while trying to get client build out of Meteor project.
         * @returns {number}
         */

    }, {
        key: 'chooseStrategy',
        value: function chooseStrategy() {
            if (this.$.env.options.forceCordovaBuild) {
                return this.indexHTMLStrategies.INDEX_FROM_CORDOVA_BUILD;
            }

            var release = this.getMeteorRelease().match(/(^\d+\.\d+\.\d+)/gmi)[0];
            if (_semver2.default.satisfies(release, '> 1.3.4')) {
                return this.indexHTMLStrategies.INDEX_FROM_RUNNING_SERVER;
            }
            if (_semver2.default.satisfies(release, '1.3.4')) {
                var explodedVersion = this.getMeteorRelease().split('.');
                if (explodedVersion.length >= 4) {
                    if (explodedVersion[3] > 1) {
                        return this.indexHTMLStrategies.INDEX_FROM_RUNNING_SERVER;
                    }
                    return this.indexHTMLStrategies.INDEX_FROM_CORDOVA_BUILD;
                }
            }
            return this.indexHTMLStrategies.INDEX_FROM_CORDOVA_BUILD;
        }

        /**
         * Checks required preconditions.
         * - Meteor version
         * - is mobile platform added
         */

    }, {
        key: 'checkPreconditions',
        value: function () {
            var _ref3 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee3() {
                var platforms;
                return _regenerator2.default.wrap(function _callee3$(_context3) {
                    while (1) {
                        switch (_context3.prev = _context3.next) {
                            case 0:
                                if (this.$.env.options.skipMobileBuild) {
                                    this.checkMeteorVersion('>= 1.2.1');
                                } else {
                                    this.checkMeteorVersion('>= 1.3.3');
                                    this.indexHTMLstrategy = this.chooseStrategy();
                                    if (this.indexHTMLstrategy === this.indexHTMLStrategies.INDEX_FROM_CORDOVA_BUILD) {
                                        this.log.debug('meteor version is < 1.3.4.2 so the index.html from cordova-build will' + ' be used');
                                    } else {
                                        this.log.debug('meteor version is >= 1.3.4.2 so the index.html will be downloaded ' + 'from __cordova/index.html');
                                    }
                                }

                                if (this.$.env.options.skipMobileBuild) {
                                    _context3.next = 15;
                                    break;
                                }

                                platforms = _fs2.default.readFileSync(this.$.env.paths.meteorApp.platforms, 'UTF-8');

                                if (!(!~platforms.indexOf('android') && !~platforms.indexOf('ios'))) {
                                    _context3.next = 15;
                                    break;
                                }

                                if (!this.$.env.options.android) {
                                    this.mobilePlatform = 'ios';
                                } else {
                                    this.mobilePlatform = 'android';
                                }
                                this.log.warn('no mobile target detected - will add \'' + this.mobilePlatform + '\' ' + 'just to get a mobile build');
                                _context3.prev = 6;
                                _context3.next = 9;
                                return this.addMobilePlatform(this.mobilePlatform);

                            case 9:
                                _context3.next = 15;
                                break;

                            case 11:
                                _context3.prev = 11;
                                _context3.t0 = _context3['catch'](6);

                                this.log.error('failed to add a mobile platform - please try to do it manually');
                                process.exit(1);

                            case 15:
                            case 'end':
                                return _context3.stop();
                        }
                    }
                }, _callee3, this, [[6, 11]]);
            }));

            function checkPreconditions() {
                return _ref3.apply(this, arguments);
            }

            return checkPreconditions;
        }()

        /**
         * Tries to add a mobile platform to meteor project.
         * @param {string} platform - platform to add
         * @returns {Promise}
         */

    }, {
        key: 'addMobilePlatform',
        value: function addMobilePlatform(platform) {
            var _this3 = this;

            return new _promise2.default(function (resolve, reject) {
                _this3.log.verbose('adding mobile platform: ' + platform);
                (0, _crossSpawn2.default)('meteor', ['add-platform', platform], {
                    cwd: _this3.$.env.paths.meteorApp.root,
                    stdio: _this3.$.env.stdio
                }).on('exit', function () {
                    var platforms = _fs2.default.readFileSync(_this3.$.env.paths.meteorApp.platforms, 'UTF-8');
                    if (!~platforms.indexOf('android') && !~platforms.indexOf('ios')) {
                        reject();
                    } else {
                        resolve();
                    }
                });
            });
        }

        /**
         * Tries to remove a mobile platform from meteor project.
         * @param {string} platform - platform to remove
         * @returns {Promise}
         */

    }, {
        key: 'removeMobilePlatform',
        value: function removeMobilePlatform(platform) {
            var _this4 = this;

            return new _promise2.default(function (resolve, reject) {
                _this4.log.verbose('removing mobile platform: ' + platform);
                (0, _crossSpawn2.default)('meteor', ['remove-platform', platform], {
                    cwd: _this4.$.env.paths.meteorApp.root,
                    stdio: _this4.$.env.stdio,
                    env: (0, _assign2.default)({ METEOR_PRETTY_OUTPUT: 0 }, process.env)
                }).on('exit', function () {
                    var platforms = _fs2.default.readFileSync(_this4.$.env.paths.meteorApp.platforms, 'UTF-8');
                    if (~platforms.indexOf(platform)) {
                        reject();
                    } else {
                        resolve();
                    }
                });
            });
        }

        /**
         * Just checks for index.html and program.json existence.
         * @returns {boolean}
         */

    }, {
        key: 'isCordovaBuildReady',
        value: function isCordovaBuildReady() {
            if (this.indexHTMLstrategy === this.indexHTMLStrategies.INDEX_FROM_CORDOVA_BUILD) {
                return this.$.utils.exists(this.$.env.paths.meteorApp.cordovaBuildIndex) && this.$.utils.exists(this.$.env.paths.meteorApp.cordovaBuildProgramJson) && (!this.oldManifest || this.oldManifest && this.oldManifest !== _fs2.default.readFileSync(this.$.env.paths.meteorApp.cordovaBuildProgramJson, 'UTF-8'));
            }
            return this.$.utils.exists(this.$.env.paths.meteorApp.webCordovaProgramJson) && (!this.oldManifest || this.oldManifest && this.oldManifest !== _fs2.default.readFileSync(this.$.env.paths.meteorApp.webCordovaProgramJson, 'UTF-8'));
        }

        /**
         * Fetches index.html from running project.
         * @returns {Promise.<*>}
         */

    }, {
        key: 'acquireIndex',
        value: function () {
            var _ref4 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee4() {
                var port, res, text;
                return _regenerator2.default.wrap(function _callee4$(_context4) {
                    while (1) {
                        switch (_context4.prev = _context4.next) {
                            case 0:
                                port = this.$.env.options.port ? this.$.env.options.port : 3080;

                                this.log.info('acquiring index.html');
                                _context4.next = 4;
                                return (0, _nodeFetch2.default)('http://127.0.0.1:' + port + '/__cordova/index.html');

                            case 4:
                                res = _context4.sent;
                                _context4.next = 7;
                                return res.text();

                            case 7:
                                text = _context4.sent;

                                if (!~text.indexOf('src="/cordova.js"')) {
                                    _context4.next = 10;
                                    break;
                                }

                                return _context4.abrupt('return', text);

                            case 10:
                                return _context4.abrupt('return', false);

                            case 11:
                            case 'end':
                                return _context4.stop();
                        }
                    }
                }, _callee4, this);
            }));

            function acquireIndex() {
                return _ref4.apply(this, arguments);
            }

            return acquireIndex;
        }()

        /**
         * Fetches mainfest.json from running project.
         * @returns {Promise.<void>}
         */

    }, {
        key: 'acquireManifest',
        value: function () {
            var _ref5 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee5() {
                var port, res, text;
                return _regenerator2.default.wrap(function _callee5$(_context5) {
                    while (1) {
                        switch (_context5.prev = _context5.next) {
                            case 0:
                                port = this.$.env.options.port ? this.$.env.options.port : 3080;

                                this.log.info('acquiring manifest.json');
                                _context5.next = 4;
                                return (0, _nodeFetch2.default)('http://127.0.0.1:' + port + '/__cordova/manifest.json?meteor_dont_serve_index=true');

                            case 4:
                                res = _context5.sent;
                                _context5.next = 7;
                                return res.text();

                            case 7:
                                text = _context5.sent;
                                return _context5.abrupt('return', JSON.parse(text));

                            case 9:
                            case 'end':
                                return _context5.stop();
                        }
                    }
                }, _callee5, this);
            }));

            function acquireManifest() {
                return _ref5.apply(this, arguments);
            }

            return acquireManifest;
        }()

        /**
         * Tries to get a mobile build from meteor app.
         * In case of failure leaves a meteor.log.
         * A lot of stuff is happening here - but the main aim is to get a mobile build from
         * .meteor/local/cordova-build/www/application and exit as soon as possible.
         *
         * @returns {Promise}
         */

    }, {
        key: 'buildMobileTarget',
        value: function buildMobileTarget() {
            var _this5 = this;

            var programJson = this.indexHTMLstrategy === this.indexHTMLStrategies.INDEX_FROM_CORDOVA_BUILD ? this.$.env.paths.meteorApp.cordovaBuildProgramJson : this.$.env.paths.meteorApp.webCordovaProgramJson;

            if (this.$.utils.exists(programJson)) {
                this.oldManifest = _fs2.default.readFileSync(programJson, 'UTF-8');
            }

            return new _promise2.default(function (resolve, reject) {
                var self = _this5;
                var log = '';
                var desiredExit = false;
                var buildTimeout = null;
                var errorTimeout = null;
                var messageTimeout = null;
                var killTimeout = null;
                var cordovaCheckInterval = null;
                var portProblem = false;

                function windowsKill(pid) {
                    self.log.debug('killing pid: ' + pid);
                    _crossSpawn2.default.sync('taskkill', ['/pid', pid, '/f', '/t']);

                    // We will look for other process which might have been created outside the
                    // process tree.
                    // Lets list all node.exe processes.
                    var out = _crossSpawn2.default.sync('wmic', ['process', 'where', 'caption="node.exe"', 'get', 'commandline,processid']).stdout.toString('utf-8').split('\n');
                    var args = self.prepareArguments();
                    // Lets mount regex.
                    var regexV1 = new RegExp(args.join('\\s+') + '\\s+(\\d+)', 'gm');
                    var regexV2 = new RegExp('"' + args.join('"\\s+"') + '"\\s+(\\d+)', 'gm');
                    // No we will check for those with the matching params.
                    out.forEach(function (line) {
                        var match = regexV1.exec(line) || regexV2.exec(line) || false;
                        if (match) {
                            self.log.debug('killing pid: ' + match[1]);
                            _crossSpawn2.default.sync('taskkill', ['/pid', match[1], '/f', '/t']);
                        }
                    });
                }

                function writeLog() {
                    _fs2.default.writeFileSync('meteor.log', log, 'UTF-8');
                }

                function clearTimeoutsAndIntervals() {
                    clearInterval(cordovaCheckInterval);
                    clearTimeout(buildTimeout);
                    clearTimeout(errorTimeout);
                    clearTimeout(messageTimeout);
                    clearTimeout(killTimeout);
                }

                var args = _this5.prepareArguments();

                _this5.log.info('running "meteor ' + args.join(' ') + '"... this might take a while');

                // Lets spawn meteor.
                var child = (0, _crossSpawn2.default)('meteor', args, {
                    env: (0, _assign2.default)({ METEOR_PRETTY_OUTPUT: 0, METEOR_NO_RELEASE_CHECK: 1 }, process.env),
                    cwd: _this5.$.env.paths.meteorApp.root
                }, { shell: true });

                // Kills the currently running meteor command.
                function kill() {
                    sll('');
                    child.kill('SIGKILL');
                    if (self.$.env.os.isWindows) {
                        windowsKill(child.pid);
                    }
                }

                function exit() {
                    killTimeout = setTimeout(function () {
                        clearTimeoutsAndIntervals();
                        desiredExit = true;
                        kill();
                        resolve();
                    }, 500);
                }

                function copyBuild() {
                    self.copyBuild().then(function () {
                        exit();
                    }).catch(function () {
                        clearTimeoutsAndIntervals();
                        kill();
                        writeLog();
                        reject('copy');
                    });
                }

                cordovaCheckInterval = setInterval(function () {
                    // Check if we already have cordova-build ready.
                    if (_this5.isCordovaBuildReady()) {
                        // If so, then exit immediately.
                        if (_this5.indexHTMLstrategy === _this5.indexHTMLStrategies.INDEX_FROM_CORDOVA_BUILD) {
                            copyBuild();
                        }
                    }
                }, 1000);

                child.stderr.on('data', function (chunk) {
                    var line = chunk.toString('UTF-8');
                    log += line + '\n';
                    if (errorTimeout) {
                        clearTimeout(errorTimeout);
                    }
                    // Do not exit if this is the warning for using --production.
                    // Output exceeds -> https://github.com/meteor/meteor/issues/8592
                    if (!~line.indexOf('--production') && !~line.indexOf('Output exceeds ')) {
                        // We will exit 1s after last error in stderr.
                        errorTimeout = setTimeout(function () {
                            clearTimeoutsAndIntervals();
                            kill();
                            writeLog();
                            reject('error');
                        }, 1000);
                    }
                });

                child.stdout.on('data', function (chunk) {
                    var line = chunk.toString('UTF-8');
                    if (!desiredExit && line.trim().replace(/[\n\r\t\v\f]+/gm, '') !== '') {
                        var linesToDisplay = line.trim().split('\n\r');
                        // Only display last line from the chunk.
                        var sanitizedLine = linesToDisplay.pop().replace(/[\n\r\t\v\f]+/gm, '');
                        sll(sanitizedLine);
                    }
                    log += line + '\n';
                    if (~line.indexOf('after_platform_add')) {
                        sll('');
                        _this5.log.info('done... 10%');
                    }

                    if (~line.indexOf('Local package version')) {
                        if (messageTimeout) {
                            clearTimeout(messageTimeout);
                        }
                        messageTimeout = setTimeout(function () {
                            sll('');
                            _this5.log.info('building in progress...');
                        }, 1500);
                    }

                    if (~line.indexOf('Preparing Cordova project')) {
                        sll('');
                        _this5.log.info('done... 60%');
                    }

                    if (~line.indexOf('Can\'t listen on port')) {
                        portProblem = true;
                    }

                    if (~line.indexOf('Your application has errors')) {
                        if (errorTimeout) {
                            clearTimeout(errorTimeout);
                        }
                        errorTimeout = setTimeout(function () {
                            clearTimeoutsAndIntervals();
                            kill();
                            writeLog();
                            reject('errorInApp');
                        }, 1000);
                    }

                    if (~line.indexOf('App running at')) {
                        copyBuild();
                    }
                });

                // When Meteor exits
                child.on('exit', function () {
                    sll('');
                    clearTimeoutsAndIntervals();
                    if (!desiredExit) {
                        writeLog();
                        if (portProblem) {
                            reject('port');
                        } else {
                            reject('exit');
                        }
                    }
                });

                buildTimeout = setTimeout(function () {
                    kill();
                    writeLog();
                    reject('timeout');
                }, _this5.$.env.options.buildTimeout ? _this5.$.env.options.buildTimeout * 1000 : 600000);
            });
        }

        /**
         * Replaces the DDP url that was used originally when Meteor was building the client.
         * @param {string} indexHtml - path to index.html from the client
         */

    }, {
        key: 'updateDdpUrl',
        value: function updateDdpUrl(indexHtml) {
            var content = void 0;
            var runtimeConfig = void 0;

            try {
                content = _fs2.default.readFileSync(indexHtml, 'UTF-8');
            } catch (e) {
                this.log.error('error loading index.html file: ' + e.message);
                process.exit(1);
            }
            if (!this.matcher.test(content)) {
                this.log.error('could not find runtime config in index file');
                process.exit(1);
            }

            try {
                var matches = content.match(this.matcher);
                runtimeConfig = JSON.parse(decodeURIComponent(matches[1]));
            } catch (e) {
                this.log.error('could not find runtime config in index file');
                process.exit(1);
            }

            if (this.$.env.options.ddpUrl.substr(-1, 1) !== '/') {
                this.$.env.options.ddpUrl += '/';
            }

            runtimeConfig.ROOT_URL = this.$.env.options.ddpUrl;
            runtimeConfig.DDP_DEFAULT_CONNECTION_URL = this.$.env.options.ddpUrl;

            content = content.replace(this.replacer, '$1"' + encodeURIComponent((0, _stringify2.default)(runtimeConfig)) + '"$3');

            try {
                _fs2.default.writeFileSync(indexHtml, content);
            } catch (e) {
                this.log.error('error writing index.html file: ' + e.message);
                process.exit(1);
            }
            this.log.info('successfully updated ddp string in the runtime config of a mobile build' + (' to ' + this.$.env.options.ddpUrl));
        }

        /**
         * Prepares the arguments passed to `meteor` command.
         * @returns {string[]}
         */

    }, {
        key: 'prepareArguments',
        value: function prepareArguments() {
            var args = ['run', '--verbose', '--mobile-server=' + this.$.env.options.ddpUrl];
            if (this.$.env.isProductionBuild()) {
                args.push('--production');
            }
            args.push('-p');
            if (this.$.env.options.port) {
                args.push(this.$.env.options.port);
            } else {
                args.push('3080');
            }
            if (this.$.env.options.meteorSettings) {
                args.push('--settings', this.$.env.options.meteorSettings);
            }
            return args;
        }

        /**
         * Validates the mobile build and copies it into electron app.
         */

    }, {
        key: 'copyBuild',
        value: function () {
            var _ref6 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee6() {
                var prefix, copyPathPostfix, indexHtml, cordovaBuild, cordovaBuildIndex, cordovaBuildProgramJson, programJson;
                return _regenerator2.default.wrap(function _callee6$(_context6) {
                    while (1) {
                        switch (_context6.prev = _context6.next) {
                            case 0:
                                this.log.debug('clearing build dir');
                                _context6.prev = 1;
                                _context6.next = 4;
                                return this.$.utils.rmWithRetries('-rf', this.$.env.paths.electronApp.meteorApp);

                            case 4:
                                _context6.next = 9;
                                break;

                            case 6:
                                _context6.prev = 6;
                                _context6.t0 = _context6['catch'](1);
                                throw new Error(_context6.t0);

                            case 9:
                                prefix = 'cordovaBuild';
                                copyPathPostfix = '';

                                if (!(this.indexHTMLstrategy === this.indexHTMLStrategies.INDEX_FROM_RUNNING_SERVER)) {
                                    _context6.next = 28;
                                    break;
                                }

                                prefix = 'webCordova';
                                copyPathPostfix = _path2.default.sep + '*';
                                indexHtml = void 0;
                                _context6.prev = 15;

                                _fs2.default.mkdir(this.$.env.paths.electronApp.meteorApp);
                                _context6.next = 19;
                                return this.acquireIndex();

                            case 19:
                                indexHtml = _context6.sent;

                                _fs2.default.writeFileSync(this.$.env.paths.electronApp.meteorAppIndex, indexHtml);
                                this.log.info('successfully downloaded index.html from running meteor app');
                                _context6.next = 28;
                                break;

                            case 24:
                                _context6.prev = 24;
                                _context6.t1 = _context6['catch'](15);

                                this.log.error('error while trying to download index.html for web.cordova, ' + 'be sure that you are running a mobile target or with' + ' --mobile-server: ', _context6.t1);
                                throw _context6.t1;

                            case 28:
                                cordovaBuild = this.$.env.paths.meteorApp[prefix];
                                cordovaBuildIndex = this.$.env.paths.meteorApp.cordovaBuildIndex;
                                cordovaBuildProgramJson = this.$.env.paths.meteorApp[prefix + 'ProgramJson'];

                                if (this.$.utils.exists(cordovaBuild)) {
                                    _context6.next = 35;
                                    break;
                                }

                                this.log.error('no mobile build found at ' + cordovaBuild);
                                this.log.error('are you sure you did run meteor with --mobile-server?');
                                throw new Error('required file not present');

                            case 35:
                                if (this.$.utils.exists(cordovaBuildProgramJson)) {
                                    _context6.next = 39;
                                    break;
                                }

                                this.log.error('no program.json found in mobile build found at ' + ('' + cordovaBuild));
                                this.log.error('are you sure you did run meteor with --mobile-server?');
                                throw new Error('required file not present');

                            case 39:
                                if (!(this.indexHTMLstrategy !== this.indexHTMLStrategies.INDEX_FROM_RUNNING_SERVER)) {
                                    _context6.next = 44;
                                    break;
                                }

                                if (this.$.utils.exists(cordovaBuildIndex)) {
                                    _context6.next = 44;
                                    break;
                                }

                                this.log.error('no index.html found in cordova build found at ' + ('' + cordovaBuild));
                                this.log.error('are you sure you did run meteor with --mobile-server?');
                                throw new Error('required file not present');

                            case 44:

                                this.log.verbose('copying mobile build');
                                _shelljs2.default.cp('-R', '' + cordovaBuild + copyPathPostfix, this.$.env.paths.electronApp.meteorApp);

                                // Because of various permission problems here we try to clear te path by clearing
                                // all possible restrictions.
                                _shelljs2.default.chmod('-R', '777', this.$.env.paths.electronApp.meteorApp);
                                if (this.$.env.os.isWindows) {
                                    _shelljs2.default.exec('attrib -r ' + this.$.env.paths.electronApp.meteorApp + _path2.default.sep + '*.* /s');
                                }

                                if (!(this.indexHTMLstrategy === this.indexHTMLStrategies.INDEX_FROM_RUNNING_SERVER)) {
                                    _context6.next = 62;
                                    break;
                                }

                                programJson = void 0;
                                _context6.prev = 50;
                                _context6.next = 53;
                                return this.acquireManifest();

                            case 53:
                                programJson = _context6.sent;

                                _fs2.default.writeFileSync(this.$.env.paths.electronApp.meteorAppProgramJson, (0, _stringify2.default)(programJson, null, 4));
                                this.log.info('successfully downloaded manifest.json from running meteor app');
                                _context6.next = 62;
                                break;

                            case 58:
                                _context6.prev = 58;
                                _context6.t2 = _context6['catch'](50);

                                this.log.error('error while trying to download manifest.json for web.cordova,' + ' be sure that you are running a mobile target or with' + ' --mobile-server: ', _context6.t2);
                                throw _context6.t2;

                            case 62:

                                this.log.info('mobile build copied to electron app');

                                this.log.debug('copy cordova.js to meteor build');
                                _shelljs2.default.cp(join(__dirname, '..', 'skeleton', 'cordova.js'), this.$.env.paths.electronApp.meteorApp);

                            case 65:
                            case 'end':
                                return _context6.stop();
                        }
                    }
                }, _callee6, this, [[1, 6], [15, 24], [50, 58]]);
            }));

            function copyBuild() {
                return _ref6.apply(this, arguments);
            }

            return copyBuild;
        }()

        /**
         * Injects Meteor.isDesktop
         */

    }, {
        key: 'injectIsDesktop',
        value: function injectIsDesktop() {
            var _this6 = this;

            this.log.info('injecting isDesktop');

            var manifestJsonPath = this.$.env.paths.meteorApp.cordovaBuildProgramJson;
            if (this.indexHTMLstrategy === this.indexHTMLStrategies.INDEX_FROM_RUNNING_SERVER) {
                manifestJsonPath = this.$.env.paths.meteorApp.webCordovaProgramJson;
            }

            try {
                (function () {
                    var manifest = JSON.parse(_fs2.default.readFileSync(manifestJsonPath, 'UTF-8')).manifest;
                    var injected = false;
                    var injectedStartupDidComplete = false;
                    var result = null;

                    // We will search in every .js file in the manifest.
                    // We could probably detect whether this is a dev or production build and only search in
                    // the correct files, but for now this should be fine.
                    manifest.forEach(function (file) {
                        var fileContents = void 0;
                        // Hacky way of setting isDesktop.
                        if (file.type === 'js') {
                            fileContents = _fs2.default.readFileSync(join(_this6.$.env.paths.electronApp.meteorApp, file.path), 'UTF-8');
                            result = _this6.injector.processFileContents(fileContents);

                            fileContents = result.fileContents;
                            injectedStartupDidComplete = result.injectedStartupDidComplete ? true : injectedStartupDidComplete;
                            injected = result.injected ? true : injected;

                            _fs2.default.writeFileSync(join(_this6.$.env.paths.electronApp.meteorApp, file.path), fileContents);
                        }
                    });

                    if (!injected) {
                        _this6.log.error('error injecting isDesktop global var.');
                        process.exit(1);
                    }
                    if (!injectedStartupDidComplete) {
                        _this6.log.error('error injecting isDesktop for startupDidComplete');
                        process.exit(1);
                    }
                })();
            } catch (e) {
                this.log.error('error occurred while injecting isDesktop: ', e);
                process.exit(1);
            }
            this.log.info('injected successfully');
        }

        /**
         * Builds, modifies and copies the meteor app to electron app.
         */

    }, {
        key: 'build',
        value: function () {
            var _ref7 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee7() {
                return _regenerator2.default.wrap(function _callee7$(_context7) {
                    while (1) {
                        switch (_context7.prev = _context7.next) {
                            case 0:
                                this.log.info('checking for any mobile platform');
                                _context7.prev = 1;
                                _context7.next = 4;
                                return this.checkPreconditions();

                            case 4:
                                _context7.next = 10;
                                break;

                            case 6:
                                _context7.prev = 6;
                                _context7.t0 = _context7['catch'](1);

                                this.log.error('error occurred during checking preconditions: ', _context7.t0);
                                process.exit(1);

                            case 10:

                                this.log.info('building meteor app');

                                if (this.$.env.options.skipMobileBuild) {
                                    _context7.next = 41;
                                    break;
                                }

                                _context7.prev = 12;
                                _context7.next = 15;
                                return this.buildMobileTarget();

                            case 15:
                                _context7.next = 39;
                                break;

                            case 17:
                                _context7.prev = 17;
                                _context7.t1 = _context7['catch'](12);
                                _context7.t2 = _context7.t1;
                                _context7.next = _context7.t2 === 'timeout' ? 22 : _context7.t2 === 'error' ? 24 : _context7.t2 === 'errorInApp' ? 26 : _context7.t2 === 'port' ? 28 : _context7.t2 === 'exit' ? 30 : _context7.t2 === 'copy' ? 32 : 34;
                                break;

                            case 22:
                                this.log.error('timeout while building, log has been written to meteor.log');
                                return _context7.abrupt('break', 35);

                            case 24:
                                this.log.error('some errors were reported during build, check meteor.log for more' + ' info');
                                return _context7.abrupt('break', 35);

                            case 26:
                                this.log.error('your meteor app has errors - look into meteor.log for more' + ' info');
                                return _context7.abrupt('break', 35);

                            case 28:
                                this.log.error('your port 3080 is currently used (you probably have this or other ' + 'meteor project running?), use `-t` or `--meteor-port` to use ' + 'different port while building');
                                return _context7.abrupt('break', 35);

                            case 30:
                                this.log.error('meteor cmd exited unexpectedly, log has been written to meteor.log');
                                return _context7.abrupt('break', 35);

                            case 32:
                                this.log.error('error encountered when copying the build');
                                return _context7.abrupt('break', 35);

                            case 34:
                                this.log.error('error occurred during building mobile target', _context7.t1);

                            case 35:
                                if (!this.mobilePlatform) {
                                    _context7.next = 38;
                                    break;
                                }

                                _context7.next = 38;
                                return this.removeMobilePlatform(this.mobilePlatform);

                            case 38:
                                process.exit(1);

                            case 39:
                                _context7.next = 50;
                                break;

                            case 41:
                                this.indexHTMLstrategy = this.chooseStrategy();
                                _context7.prev = 42;
                                _context7.next = 45;
                                return this.copyBuild();

                            case 45:
                                _context7.next = 50;
                                break;

                            case 47:
                                _context7.prev = 47;
                                _context7.t3 = _context7['catch'](42);

                                process.exit(1);

                            case 50:

                                this.injectIsDesktop();

                                this.changeDdpUrl();

                                _context7.prev = 52;
                                _context7.next = 55;
                                return this.packToAsar();

                            case 55:
                                _context7.next = 61;
                                break;

                            case 57:
                                _context7.prev = 57;
                                _context7.t4 = _context7['catch'](52);

                                this.log.error('error while packing meteor app to asar');
                                process.exit(1);

                            case 61:

                                this.log.info('meteor build finished');

                                if (!this.mobilePlatform) {
                                    _context7.next = 65;
                                    break;
                                }

                                _context7.next = 65;
                                return this.removeMobilePlatform(this.mobilePlatform);

                            case 65:
                            case 'end':
                                return _context7.stop();
                        }
                    }
                }, _callee7, this, [[1, 6], [12, 17], [42, 47], [52, 57]]);
            }));

            function build() {
                return _ref7.apply(this, arguments);
            }

            return build;
        }()
    }, {
        key: 'changeDdpUrl',
        value: function changeDdpUrl() {
            if (this.$.env.options.ddpUrl !== null) {
                try {
                    this.updateDdpUrl(this.$.env.paths.electronApp.meteorAppIndex);
                } catch (e) {
                    this.log.error('error while trying to change the ddp url: ' + e.message);
                }
            }
        }
    }, {
        key: 'packToAsar',
        value: function packToAsar() {
            var _this7 = this;

            this.log.info('packing meteor app to asar archive');
            return new _promise2.default(function (resolve, reject) {
                return _asar2.default.createPackage(_this7.$.env.paths.electronApp.meteorApp, _path2.default.join(_this7.$.env.paths.electronApp.root, 'meteor.asar'), function () {
                    // On Windows some files might still be blocked. Giving a tick for them to be
                    // ready for deletion.
                    (0, _setImmediate3.default)(function () {
                        _this7.log.verbose('clearing meteor app after packing');
                        _this7.$.utils.rmWithRetries('-rf', _this7.$.env.paths.electronApp.meteorApp).then(function () {
                            resolve();
                        }).catch(function (e) {
                            reject(e);
                        });
                    });
                });
            });
        }
    }]);
    return MeteorApp;
}();

exports.default = MeteorApp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9tZXRlb3JBcHAuanMiXSwibmFtZXMiOlsiam9pbiIsInNsbCIsInN0ZG91dCIsIk1ldGVvckFwcCIsIiQiLCJsb2ciLCJtb2JpbGVQbGF0Zm9ybSIsIm9sZE1hbmlmZXN0IiwiaW5qZWN0b3IiLCJtYXRjaGVyIiwiUmVnRXhwIiwicmVwbGFjZXIiLCJtZXRlb3JWZXJzaW9uIiwiaW5kZXhIVE1Mc3RyYXRlZ3kiLCJpbmRleEhUTUxTdHJhdGVnaWVzIiwiSU5ERVhfRlJPTV9DT1JET1ZBX0JVSUxEIiwiSU5ERVhfRlJPTV9SVU5OSU5HX1NFUlZFUiIsInBhY2thZ2VzIiwidXNlZFBhY2thZ2VzIiwicmVhZEZpbGVTeW5jIiwiZW52IiwicGF0aHMiLCJtZXRlb3JBcHAiLCJzcGxpdCIsInNvbWUiLCJtZXRlb3JQYWNrYWdlIiwiaW5kZXhPZiIsInBhY2thZ2VUb0ZpbmQiLCJ2ZXJzaW9ucyIsInBhY2thZ2VzV2l0aFZlcnNpb24iLCJ3aG8iLCJjaGVja1BhY2thZ2VzIiwid2FybiIsImFkZFBhY2thZ2VzIiwiRXJyb3IiLCJjaGVja1BhY2thZ2VzVmVyc2lvbiIsImRlc2t0b3AiLCJnZXRTZXR0aW5ncyIsImRlc2t0b3BIQ1AiLCJ2ZXJib3NlIiwibWFwIiwicGFja2FnZU5hbWUiLCJnZXRWZXJzaW9uIiwiZW5zdXJlUGFja2FnZXMiLCJpbmZvIiwicmVzb2x2ZSIsInJlamVjdCIsImNvbmNhdCIsInJlcGxhY2UiLCJjd2QiLCJyb290Iiwic3RkaW8iLCJwcm9jZXNzIiwic3RkZXJyIiwiTUVURU9SX1BSRVRUWV9PVVRQVVQiLCJNRVRFT1JfTk9fUkVMRUFTRV9DSEVDSyIsIm9uIiwiY29kZSIsImdpdElnbm9yZSIsImZpbHRlciIsImlnbm9yZWRQYXRoIiwidHJpbSIsImVsZWN0cm9uQXBwIiwicm9vdE5hbWUiLCJwdXNoIiwid3JpdGVGaWxlU3luYyIsInJlbGVhc2UiLCJ2ZXJzaW9uUmFuZ2UiLCJnZXRNZXRlb3JSZWxlYXNlIiwibWF0Y2giLCJzYXRpc2ZpZXMiLCJvcHRpb25zIiwic2tpcE1vYmlsZUJ1aWxkIiwiZXJyb3IiLCJleGl0IiwiZm9yY2VDb3Jkb3ZhQnVpbGQiLCJleHBsb2RlZFZlcnNpb24iLCJsZW5ndGgiLCJjaGVja01ldGVvclZlcnNpb24iLCJjaG9vc2VTdHJhdGVneSIsImRlYnVnIiwicGxhdGZvcm1zIiwiYW5kcm9pZCIsImFkZE1vYmlsZVBsYXRmb3JtIiwicGxhdGZvcm0iLCJ1dGlscyIsImV4aXN0cyIsImNvcmRvdmFCdWlsZEluZGV4IiwiY29yZG92YUJ1aWxkUHJvZ3JhbUpzb24iLCJ3ZWJDb3Jkb3ZhUHJvZ3JhbUpzb24iLCJwb3J0IiwicmVzIiwidGV4dCIsIkpTT04iLCJwYXJzZSIsInByb2dyYW1Kc29uIiwic2VsZiIsImRlc2lyZWRFeGl0IiwiYnVpbGRUaW1lb3V0IiwiZXJyb3JUaW1lb3V0IiwibWVzc2FnZVRpbWVvdXQiLCJraWxsVGltZW91dCIsImNvcmRvdmFDaGVja0ludGVydmFsIiwicG9ydFByb2JsZW0iLCJ3aW5kb3dzS2lsbCIsInBpZCIsInN5bmMiLCJvdXQiLCJ0b1N0cmluZyIsImFyZ3MiLCJwcmVwYXJlQXJndW1lbnRzIiwicmVnZXhWMSIsInJlZ2V4VjIiLCJmb3JFYWNoIiwibGluZSIsImV4ZWMiLCJ3cml0ZUxvZyIsImNsZWFyVGltZW91dHNBbmRJbnRlcnZhbHMiLCJjbGVhckludGVydmFsIiwiY2xlYXJUaW1lb3V0IiwiY2hpbGQiLCJzaGVsbCIsImtpbGwiLCJvcyIsImlzV2luZG93cyIsInNldFRpbWVvdXQiLCJjb3B5QnVpbGQiLCJ0aGVuIiwiY2F0Y2giLCJzZXRJbnRlcnZhbCIsImlzQ29yZG92YUJ1aWxkUmVhZHkiLCJjaHVuayIsImxpbmVzVG9EaXNwbGF5Iiwic2FuaXRpemVkTGluZSIsInBvcCIsImluZGV4SHRtbCIsImNvbnRlbnQiLCJydW50aW1lQ29uZmlnIiwiZSIsIm1lc3NhZ2UiLCJ0ZXN0IiwibWF0Y2hlcyIsImRlY29kZVVSSUNvbXBvbmVudCIsImRkcFVybCIsInN1YnN0ciIsIlJPT1RfVVJMIiwiRERQX0RFRkFVTFRfQ09OTkVDVElPTl9VUkwiLCJlbmNvZGVVUklDb21wb25lbnQiLCJpc1Byb2R1Y3Rpb25CdWlsZCIsIm1ldGVvclNldHRpbmdzIiwicm1XaXRoUmV0cmllcyIsInByZWZpeCIsImNvcHlQYXRoUG9zdGZpeCIsInNlcCIsIm1rZGlyIiwiYWNxdWlyZUluZGV4IiwibWV0ZW9yQXBwSW5kZXgiLCJjb3Jkb3ZhQnVpbGQiLCJjcCIsImNobW9kIiwiYWNxdWlyZU1hbmlmZXN0IiwibWV0ZW9yQXBwUHJvZ3JhbUpzb24iLCJfX2Rpcm5hbWUiLCJtYW5pZmVzdEpzb25QYXRoIiwibWFuaWZlc3QiLCJpbmplY3RlZCIsImluamVjdGVkU3RhcnR1cERpZENvbXBsZXRlIiwicmVzdWx0IiwiZmlsZSIsImZpbGVDb250ZW50cyIsInR5cGUiLCJwYXRoIiwicHJvY2Vzc0ZpbGVDb250ZW50cyIsImNoZWNrUHJlY29uZGl0aW9ucyIsImJ1aWxkTW9iaWxlVGFyZ2V0IiwicmVtb3ZlTW9iaWxlUGxhdGZvcm0iLCJpbmplY3RJc0Rlc2t0b3AiLCJjaGFuZ2VEZHBVcmwiLCJwYWNrVG9Bc2FyIiwidXBkYXRlRGRwVXJsIiwiY3JlYXRlUGFja2FnZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUE7Ozs7QUFDQTs7Ozs7O0lBRVFBLEksa0JBQUFBLEk7O0FBQ1IsSUFBTUMsTUFBTSx3QkFBY0MsTUFBMUI7O0FBRUE7O0FBRUE7Ozs7OztJQUtxQkMsUzs7QUFFakI7Ozs7QUFJQSx1QkFBWUMsQ0FBWixFQUFlO0FBQUE7O0FBQ1gsYUFBS0MsR0FBTCxHQUFXLGtCQUFRLFdBQVIsQ0FBWDtBQUNBLGFBQUtELENBQUwsR0FBU0EsQ0FBVDtBQUNBLGFBQUtFLGNBQUwsR0FBc0IsSUFBdEI7QUFDQSxh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QWlCeUMsV0FBakIsQ0FBNkJaLElBQXZDLEVBQTZDLGFBQTdDLENBRkosRUFHSSxZQUFNO0FBQ0Y7QUFDQTtBQUNBLGdEQUFhLFlBQU07QUFDZiwrQkFBSzdDLEdBQUwsQ0FBU2tDLE9BQVQsQ0FBaUIsbUNBQWpCO0FBQ0EsK0JBQUtuQyxDQUFMLENBQU9pRixLQUFQLENBQ0tpRSxhQURMLENBQ21CLEtBRG5CLEVBQzBCLE9BQUtsSixDQUFMLENBQU9nQixHQUFQLENBQVdDLEtBQVgsQ0FBaUJ5QyxXQUFqQixDQUE2QnhDLFNBRHZELEVBRUt5RyxJQUZMLENBRVUsWUFBTTtBQUNSbEY7QUFDSCx5QkFKTCxFQUtLbUYsS0FMTCxDQUtXLFVBQUNVLENBQUQsRUFBTztBQUNWNUYsbUNBQU80RixDQUFQO0FBQ0gseUJBUEw7QUFRSCxxQkFWRDtBQVdILGlCQWpCTCxDQURlO0FBQUEsYUFBWixDQUFQO0FBcUJIOzs7OztrQkExNEJnQnZJLFMiLCJmaWxlIjoibWV0ZW9yQXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBzcGF3biBmcm9tICdjcm9zcy1zcGF3bic7XG5pbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7XG5pbXBvcnQgc2hlbGwgZnJvbSAnc2hlbGxqcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBzaW5nbGVMaW5lTG9nIGZyb20gJ3NpbmdsZS1saW5lLWxvZyc7XG5pbXBvcnQgYXNhciBmcm9tICdhc2FyJztcbmltcG9ydCBmZXRjaCBmcm9tICdub2RlLWZldGNoJztcblxuaW1wb3J0IElzRGVza3RvcEluamVjdG9yIGZyb20gJy4uL3NrZWxldG9uL21vZHVsZXMvYXV0b3VwZGF0ZS9pc0Rlc2t0b3BJbmplY3Rvcic7XG5pbXBvcnQgTG9nIGZyb20gJy4vbG9nJztcblxuY29uc3QgeyBqb2luIH0gPSBwYXRoO1xuY29uc3Qgc2xsID0gc2luZ2xlTGluZUxvZy5zdGRvdXQ7XG5cbi8vIFRPRE86IHJlZmFjdG9yIGFsbCBzdHJhdGVneSBpZnMgdG8gb25lIHBsYWNlXG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgTWV0ZW9yIGFwcC5cbiAqIEBwcm9wZXJ0eSB7TWV0ZW9yRGVza3RvcH0gJFxuICogQGNsYXNzXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1ldGVvckFwcCB7XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge01ldGVvckRlc2t0b3B9ICQgLSBjb250ZXh0XG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoJCkge1xuICAgICAgICB0aGlzLmxvZyA9IG5ldyBMb2coJ21ldGVvckFwcCcpO1xuICAgICAgICB0aGlzLiQgPSAkO1xuICAgICAgICB0aGlzLm1vYmlsZVBsYXRmb3JtID0gbnVsbDtcbiAgICAgICAgdGhpcy5vbGRNYW5pZmVzdCA9IG51bGw7XG4gICAgICAgIHRoaXMuaW5qZWN0b3IgPSBuZXcgSXNEZXNrdG9wSW5qZWN0b3IoKTtcbiAgICAgICAgdGhpcy5tYXRjaGVyID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICdfX21ldGVvcl9ydW50aW1lX2NvbmZpZ19fID0gSlNPTi5wYXJzZVxcXFwoZGVjb2RlVVJJQ29tcG9uZW50XFxcXChcIihbXlwiXSopXCJcXFxcKVxcXFwpJ1xuICAgICAgICApO1xuICAgICAgICB0aGlzLnJlcGxhY2VyID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICcoX19tZXRlb3JfcnVudGltZV9jb25maWdfXyA9IEpTT04ucGFyc2VcXFxcKGRlY29kZVVSSUNvbXBvbmVudFxcXFwoKVwiKFteXCJdKilcIihcXFxcKVxcXFwpKSdcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5tZXRlb3JWZXJzaW9uID0gbnVsbDtcbiAgICAgICAgdGhpcy5pbmRleEhUTUxzdHJhdGVneSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5pbmRleEhUTUxTdHJhdGVnaWVzID0ge1xuICAgICAgICAgICAgSU5ERVhfRlJPTV9DT1JET1ZBX0JVSUxEOiAxLFxuICAgICAgICAgICAgSU5ERVhfRlJPTV9SVU5OSU5HX1NFUlZFUjogMlxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvb2tzIGZvciBzcGVjaWZpZWQgcGFja2FnZXMgaW4gLm1ldGVvci9wYWNrYWdlcy4gSW4gb3RoZXIgd29yZHMgY2hlY2tzIGlmIHRoZSBwcm9qZWN0IGhhc1xuICAgICAqIHNwZWNpZmllZCBwYWNrYWdlcyBhZGRlZC5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYWNrYWdlc1xuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIGNoZWNrUGFja2FnZXMocGFja2FnZXMpIHtcbiAgICAgICAgY29uc3QgdXNlZFBhY2thZ2VzID0gZnMucmVhZEZpbGVTeW5jKHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLnBhY2thZ2VzLCAnVVRGLTgnKS5zcGxpdCgnXFxuJyk7XG4gICAgICAgIHJldHVybiAhcGFja2FnZXMuc29tZShcbiAgICAgICAgICAgIHBhY2thZ2VUb0ZpbmQgPT5cbiAgICAgICAgICAgICAgICAhdXNlZFBhY2thZ2VzLnNvbWUobWV0ZW9yUGFja2FnZSA9PiB+bWV0ZW9yUGFja2FnZS5pbmRleE9mKHBhY2thZ2VUb0ZpbmQpKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvb2tzIGZvciBzcGVjaWZpZWQgcGFja2FnZXMgaW4gLm1ldGVvci9wYWNrYWdlcy4gSW4gb3RoZXIgd29yZHMgY2hlY2tzIGlmIHRoZSBwcm9qZWN0IGhhc1xuICAgICAqIHNwZWNpZmllZCBwYWNrYWdlcyBhZGRlZC5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYWNrYWdlc1xuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIGNoZWNrUGFja2FnZXNWZXJzaW9uKHBhY2thZ2VzKSB7XG4gICAgICAgIGNvbnN0IHVzZWRQYWNrYWdlcyA9IGZzLnJlYWRGaWxlU3luYyh0aGlzLiQuZW52LnBhdGhzLm1ldGVvckFwcC52ZXJzaW9ucywgJ1VURi04Jykuc3BsaXQoJ1xcbicpO1xuICAgICAgICByZXR1cm4gIXBhY2thZ2VzLnNvbWUoXG4gICAgICAgICAgICBwYWNrYWdlVG9GaW5kID0+ICF1c2VkUGFja2FnZXMuc29tZShtZXRlb3JQYWNrYWdlID0+IG1ldGVvclBhY2thZ2UgPT09IHBhY2thZ2VUb0ZpbmQpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5zdXJlcyBjZXJ0YWluIHBhY2thZ2VzIGFyZSBhZGRlZCB0byBtZXRlb3IgcHJvamVjdCBhbmQgaW4gY29ycmVjdCB2ZXJzaW9uLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhY2thZ2VzXG4gICAgICogQHBhcmFtIHtBcnJheX0gcGFja2FnZXNXaXRoVmVyc2lvblxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB3aG8gLSBuYW1lIG9mIHRoZSBlbnRpdHkgdGhhdCByZXF1ZXN0cyBwcmVzZW5jZSBvZiB0aG9zIHBhY2thZ2VzIChjYW4gYmUgdGhlXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgIGludGVncmF0aW9uIGl0c2VsZiBvciBhIHBsdWdpbilcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48dm9pZD59XG4gICAgICovXG4gICAgYXN5bmMgZW5zdXJlUGFja2FnZXMocGFja2FnZXMsIHBhY2thZ2VzV2l0aFZlcnNpb24sIHdobykge1xuICAgICAgICBpZiAoIXRoaXMuY2hlY2tQYWNrYWdlcyhwYWNrYWdlcykpIHtcbiAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYCR7d2hvfSByZXF1aXJlcyBzb21lIHBhY2thZ2VzIHRoYXQgYXJlIG5vdCBhZGRlZCB0byBwcm9qZWN0LCB3aWxsIHRyeSB0byBhZGQgdGhlbSBub3dgKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hZGRQYWNrYWdlcyhwYWNrYWdlcywgcGFja2FnZXNXaXRoVmVyc2lvbik7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5jaGVja1BhY2thZ2VzVmVyc2lvbihwYWNrYWdlc1dpdGhWZXJzaW9uKSkge1xuICAgICAgICAgICAgdGhpcy5sb2cud2FybihgJHt3aG99IHJlcXVpcmVkIHBhY2thZ2VzIHZlcnNpb24gaXMgZGlmZmVyZW50LCBmaXhpbmcgaXRgKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hZGRQYWNrYWdlcyhwYWNrYWdlcywgcGFja2FnZXNXaXRoVmVyc2lvbik7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5zdXJlcyB0aGF0IHJlcXVpcmVkIHBhY2thZ2VzIGFyZSBhZGRlZCB0byB0aGUgTWV0ZW9yIGFwcC5cbiAgICAgKi9cbiAgICBhc3luYyBlbnN1cmVEZXNrdG9wSENQUGFja2FnZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLiQuZGVza3RvcC5nZXRTZXR0aW5ncygpLmRlc2t0b3BIQ1ApIHtcbiAgICAgICAgICAgIHRoaXMubG9nLnZlcmJvc2UoJ2Rlc2t0b3BIQ1AgaXMgZW5hYmxlZCwgY2hlY2tpbmcgZm9yIHJlcXVpcmVkIHBhY2thZ2VzJyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHBhY2thZ2VzID0gWydvbWVnYTptZXRlb3ItZGVza3RvcC13YXRjaGVyJywgJ29tZWdhOm1ldGVvci1kZXNrdG9wLWJ1bmRsZXInXTtcbiAgICAgICAgICAgIGNvbnN0IHBhY2thZ2VzV2l0aFZlcnNpb24gPSBwYWNrYWdlcy5tYXAocGFja2FnZU5hbWUgPT4gYCR7cGFja2FnZU5hbWV9QCR7dGhpcy4kLmdldFZlcnNpb24oKX1gKTtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmVuc3VyZVBhY2thZ2VzKHBhY2thZ2VzLCBwYWNrYWdlc1dpdGhWZXJzaW9uLCAnZGVza3RvcEhDUCcpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9nLnZlcmJvc2UoJ2Rlc2t0b3BIQ1AgaXMgbm90IGVuYWJsZWQsIHNraXBwaW5nIGNoZWNraW5nIGZvciByZXF1aXJlZCBwYWNrYWdlcycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBwYWNrYWdlcyB0byB0aGUgbWV0ZW9yIGFwcC5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYWNrYWdlcyAgICAgICAgICAgIC0gYXJyYXkgd2l0aCBuYW1lcyBvZiB0aGUgcGFja2FnZXMgdG8gYWRkXG4gICAgICogQHBhcmFtIHtBcnJheX0gcGFja2FnZXNXaXRoVmVyc2lvbiAtIGFycmF5IHdpdGggbmFtZXMgYW5kIHZlcnNpb25zIG9mIHRoZSBwYWNrYWdlcyB0byBhZGRcbiAgICAgKi9cbiAgICBhZGRQYWNrYWdlcyhwYWNrYWdlcywgcGFja2FnZXNXaXRoVmVyc2lvbikge1xuICAgICAgICB0aGlzLmxvZy5pbmZvKCdhZGRpbmcgcGFja2FnZXMgdG8gbWV0ZW9yIHByb2plY3QnLCBwYWNrYWdlc1dpdGhWZXJzaW9uKTtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHNwYXduKFxuICAgICAgICAgICAgICAgICdtZXRlb3InLFxuICAgICAgICAgICAgICAgIFsnYWRkJ10uY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICBwYWNrYWdlc1dpdGhWZXJzaW9uLm1hcChwYWNrYWdlTmFtZSA9PiBwYWNrYWdlTmFtZS5yZXBsYWNlKCdAJywgJ0A9JykpKSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGN3ZDogdGhpcy4kLmVudi5wYXRocy5tZXRlb3JBcHAucm9vdCxcbiAgICAgICAgICAgICAgICAgICAgc3RkaW86IFsncGlwZScsICdwaXBlJywgcHJvY2Vzcy5zdGRlcnJdLFxuICAgICAgICAgICAgICAgICAgICBlbnY6IE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAgICAgICAgICAgICAgICB7IE1FVEVPUl9QUkVUVFlfT1VUUFVUOiAwLCBNRVRFT1JfTk9fUkVMRUFTRV9DSEVDSzogMSB9LCBwcm9jZXNzLmVudilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLm9uKCdleGl0JywgKGNvZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY29kZSAhPT0gMCB8fCAhdGhpcy5jaGVja1BhY2thZ2VzKHBhY2thZ2VzKSkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoJ2FkZGluZyBwYWNrYWdlcyBmYWlsZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZHMgZW50cnkgdG8gLm1ldGVvci8uZ2l0aWdub3JlIGlmIG5lY2Vzc2FyeS5cbiAgICAgKi9cbiAgICB1cGRhdGVHaXRJZ25vcmUoKSB7XG4gICAgICAgIHRoaXMubG9nLnZlcmJvc2UoJ3VwZGF0aW5nIC5tZXRlb3IvLmdpdGlnbm9yZScpO1xuICAgICAgICAvLyBMZXRzIHJlYWQgdGhlIC5tZXRlb3IvLmdpdGlnbm9yZSBhbmQgZmlsdGVyIG91dCBibGFuayBsaW5lcy5cbiAgICAgICAgY29uc3QgZ2l0SWdub3JlID0gZnMucmVhZEZpbGVTeW5jKHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLmdpdElnbm9yZSwgJ1VURi04JylcbiAgICAgICAgICAgIC5zcGxpdCgnXFxuJykuZmlsdGVyKGlnbm9yZWRQYXRoID0+IGlnbm9yZWRQYXRoLnRyaW0oKSAhPT0gJycpO1xuXG4gICAgICAgIGlmICghfmdpdElnbm9yZS5pbmRleE9mKHRoaXMuJC5lbnYucGF0aHMuZWxlY3Ryb25BcHAucm9vdE5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLmxvZy52ZXJib3NlKGBhZGRpbmcgJHt0aGlzLiQuZW52LnBhdGhzLmVsZWN0cm9uQXBwLnJvb3ROYW1lfSB0byAubWV0ZW9yLy5naXRpZ25vcmVgKTtcbiAgICAgICAgICAgIGdpdElnbm9yZS5wdXNoKHRoaXMuJC5lbnYucGF0aHMuZWxlY3Ryb25BcHAucm9vdE5hbWUpO1xuXG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLmdpdElnbm9yZSwgZ2l0SWdub3JlLmpvaW4oJ1xcbicpLCAnVVRGLTgnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlYWRzIHRoZSBNZXRlb3IgcmVsZWFzZSB2ZXJzaW9uIHVzZWQgaW4gdGhlIGFwcC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldE1ldGVvclJlbGVhc2UoKSB7XG4gICAgICAgIGxldCByZWxlYXNlID0gZnMucmVhZEZpbGVTeW5jKHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLnJlbGVhc2UsICdVVEYtOCcpLnNwbGl0KCdcXG4nKVswXTtcbiAgICAgICAgcmVsZWFzZSA9IHJlbGVhc2Uuc3BsaXQoJ0AnKVsxXTtcbiAgICAgICAgLy8gV2UgZG8gbm90IGNhcmUgaWYgaXQgaXMgYmV0YS5cbiAgICAgICAgaWYgKH5yZWxlYXNlLmluZGV4T2YoJy0nKSkge1xuICAgICAgICAgICAgcmVsZWFzZSA9IHJlbGVhc2Uuc3BsaXQoJy0nKVswXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVsZWFzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZSBtZXRlb3IgdmVyc2lvbiBhZ2FpbnN0IGEgdmVyc2lvblJhbmdlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJzaW9uUmFuZ2UgLSBzZW12ZXIgdmVyc2lvbiByYW5nZVxuICAgICAqL1xuICAgIGNoZWNrTWV0ZW9yVmVyc2lvbih2ZXJzaW9uUmFuZ2UpIHtcbiAgICAgICAgbGV0IHJlbGVhc2UgPSB0aGlzLmdldE1ldGVvclJlbGVhc2UoKTtcbiAgICAgICAgcmVsZWFzZSA9IHJlbGVhc2UubWF0Y2goLyheXFxkK1xcLlxcZCtcXC5cXGQrKS9nbWkpWzBdO1xuICAgICAgICBpZiAoIXNlbXZlci5zYXRpc2ZpZXMocmVsZWFzZSwgdmVyc2lvblJhbmdlKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJC5lbnYub3B0aW9ucy5za2lwTW9iaWxlQnVpbGQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgd3JvbmcgbWV0ZW9yIHZlcnNpb24gKCR7cmVsZWFzZX0pIGluIHByb2plY3QgLSBvbmx5IGAgK1xuICAgICAgICAgICAgICAgICAgICBgJHt2ZXJzaW9uUmFuZ2V9IGlzIHN1cHBvcnRlZGBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgd3JvbmcgbWV0ZW9yIHZlcnNpb24gKCR7cmVsZWFzZX0pIGluIHByb2plY3QgLSBvbmx5IGAgK1xuICAgICAgICAgICAgICAgICAgICBgJHt2ZXJzaW9uUmFuZ2V9IGlzIHN1cHBvcnRlZCBmb3IgYXV0b21hdGljIG1ldGVvciBidWlsZHMgKHlvdSBjYW4gYWx3YXlzIGAgK1xuICAgICAgICAgICAgICAgICAgICAndHJ5IHdpdGggYC0tc2tpcC1tb2JpbGUtYnVpbGRgIGlmIHlvdSBhcmUgdXNpbmcgbWV0ZW9yID49IDEuMi4xJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWNpZGVzIHdoaWNoIHN0cmF0ZWd5IHRvIHVzZSB3aGlsZSB0cnlpbmcgdG8gZ2V0IGNsaWVudCBidWlsZCBvdXQgb2YgTWV0ZW9yIHByb2plY3QuXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBjaG9vc2VTdHJhdGVneSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJC5lbnYub3B0aW9ucy5mb3JjZUNvcmRvdmFCdWlsZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhIVE1MU3RyYXRlZ2llcy5JTkRFWF9GUk9NX0NPUkRPVkFfQlVJTEQ7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZWxlYXNlID0gdGhpcy5nZXRNZXRlb3JSZWxlYXNlKCkubWF0Y2goLyheXFxkK1xcLlxcZCtcXC5cXGQrKS9nbWkpWzBdO1xuICAgICAgICBpZiAoc2VtdmVyLnNhdGlzZmllcyhyZWxlYXNlLCAnPiAxLjMuNCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbmRleEhUTUxTdHJhdGVnaWVzLklOREVYX0ZST01fUlVOTklOR19TRVJWRVI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbXZlci5zYXRpc2ZpZXMocmVsZWFzZSwgJzEuMy40JykpIHtcbiAgICAgICAgICAgIGNvbnN0IGV4cGxvZGVkVmVyc2lvbiA9IHRoaXMuZ2V0TWV0ZW9yUmVsZWFzZSgpLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICBpZiAoZXhwbG9kZWRWZXJzaW9uLmxlbmd0aCA+PSA0KSB7XG4gICAgICAgICAgICAgICAgaWYgKGV4cGxvZGVkVmVyc2lvblszXSA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhIVE1MU3RyYXRlZ2llcy5JTkRFWF9GUk9NX1JVTk5JTkdfU0VSVkVSO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbmRleEhUTUxTdHJhdGVnaWVzLklOREVYX0ZST01fQ09SRE9WQV9CVUlMRDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5pbmRleEhUTUxTdHJhdGVnaWVzLklOREVYX0ZST01fQ09SRE9WQV9CVUlMRDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgcmVxdWlyZWQgcHJlY29uZGl0aW9ucy5cbiAgICAgKiAtIE1ldGVvciB2ZXJzaW9uXG4gICAgICogLSBpcyBtb2JpbGUgcGxhdGZvcm0gYWRkZWRcbiAgICAgKi9cbiAgICBhc3luYyBjaGVja1ByZWNvbmRpdGlvbnMoKSB7XG4gICAgICAgIGlmICh0aGlzLiQuZW52Lm9wdGlvbnMuc2tpcE1vYmlsZUJ1aWxkKSB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrTWV0ZW9yVmVyc2lvbignPj0gMS4yLjEnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tNZXRlb3JWZXJzaW9uKCc+PSAxLjMuMycpO1xuICAgICAgICAgICAgdGhpcy5pbmRleEhUTUxzdHJhdGVneSA9IHRoaXMuY2hvb3NlU3RyYXRlZ3koKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmluZGV4SFRNTHN0cmF0ZWd5ID09PSB0aGlzLmluZGV4SFRNTFN0cmF0ZWdpZXMuSU5ERVhfRlJPTV9DT1JET1ZBX0JVSUxEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoXG4gICAgICAgICAgICAgICAgICAgICdtZXRlb3IgdmVyc2lvbiBpcyA8IDEuMy40LjIgc28gdGhlIGluZGV4Lmh0bWwgZnJvbSBjb3Jkb3ZhLWJ1aWxkIHdpbGwnICtcbiAgICAgICAgICAgICAgICAgICAgJyBiZSB1c2VkJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKFxuICAgICAgICAgICAgICAgICAgICAnbWV0ZW9yIHZlcnNpb24gaXMgPj0gMS4zLjQuMiBzbyB0aGUgaW5kZXguaHRtbCB3aWxsIGJlIGRvd25sb2FkZWQgJyArXG4gICAgICAgICAgICAgICAgICAgICdmcm9tIF9fY29yZG92YS9pbmRleC5odG1sJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuJC5lbnYub3B0aW9ucy5za2lwTW9iaWxlQnVpbGQpIHtcbiAgICAgICAgICAgIGNvbnN0IHBsYXRmb3JtcyA9IGZzLnJlYWRGaWxlU3luYyh0aGlzLiQuZW52LnBhdGhzLm1ldGVvckFwcC5wbGF0Zm9ybXMsICdVVEYtOCcpO1xuICAgICAgICAgICAgaWYgKCF+cGxhdGZvcm1zLmluZGV4T2YoJ2FuZHJvaWQnKSAmJiAhfnBsYXRmb3Jtcy5pbmRleE9mKCdpb3MnKSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy4kLmVudi5vcHRpb25zLmFuZHJvaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2JpbGVQbGF0Zm9ybSA9ICdpb3MnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9iaWxlUGxhdGZvcm0gPSAnYW5kcm9pZCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYG5vIG1vYmlsZSB0YXJnZXQgZGV0ZWN0ZWQgLSB3aWxsIGFkZCAnJHt0aGlzLm1vYmlsZVBsYXRmb3JtfScgYCArXG4gICAgICAgICAgICAgICAgICAgICdqdXN0IHRvIGdldCBhIG1vYmlsZSBidWlsZCdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYWRkTW9iaWxlUGxhdGZvcm0odGhpcy5tb2JpbGVQbGF0Zm9ybSk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZy5lcnJvcignZmFpbGVkIHRvIGFkZCBhIG1vYmlsZSBwbGF0Zm9ybSAtIHBsZWFzZSB0cnkgdG8gZG8gaXQgbWFudWFsbHknKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWVzIHRvIGFkZCBhIG1vYmlsZSBwbGF0Zm9ybSB0byBtZXRlb3IgcHJvamVjdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcGxhdGZvcm0gLSBwbGF0Zm9ybSB0byBhZGRcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBhZGRNb2JpbGVQbGF0Zm9ybShwbGF0Zm9ybSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2cudmVyYm9zZShgYWRkaW5nIG1vYmlsZSBwbGF0Zm9ybTogJHtwbGF0Zm9ybX1gKTtcbiAgICAgICAgICAgIHNwYXduKCdtZXRlb3InLCBbJ2FkZC1wbGF0Zm9ybScsIHBsYXRmb3JtXSwge1xuICAgICAgICAgICAgICAgIGN3ZDogdGhpcy4kLmVudi5wYXRocy5tZXRlb3JBcHAucm9vdCxcbiAgICAgICAgICAgICAgICBzdGRpbzogdGhpcy4kLmVudi5zdGRpb1xuICAgICAgICAgICAgfSkub24oJ2V4aXQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGxhdGZvcm1zID0gZnMucmVhZEZpbGVTeW5jKHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLnBsYXRmb3JtcywgJ1VURi04Jyk7XG4gICAgICAgICAgICAgICAgaWYgKCF+cGxhdGZvcm1zLmluZGV4T2YoJ2FuZHJvaWQnKSAmJiAhfnBsYXRmb3Jtcy5pbmRleE9mKCdpb3MnKSkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWVzIHRvIHJlbW92ZSBhIG1vYmlsZSBwbGF0Zm9ybSBmcm9tIG1ldGVvciBwcm9qZWN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwbGF0Zm9ybSAtIHBsYXRmb3JtIHRvIHJlbW92ZVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIHJlbW92ZU1vYmlsZVBsYXRmb3JtKHBsYXRmb3JtKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvZy52ZXJib3NlKGByZW1vdmluZyBtb2JpbGUgcGxhdGZvcm06ICR7cGxhdGZvcm19YCk7XG4gICAgICAgICAgICBzcGF3bignbWV0ZW9yJywgWydyZW1vdmUtcGxhdGZvcm0nLCBwbGF0Zm9ybV0sIHtcbiAgICAgICAgICAgICAgICBjd2Q6IHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLnJvb3QsXG4gICAgICAgICAgICAgICAgc3RkaW86IHRoaXMuJC5lbnYuc3RkaW8sXG4gICAgICAgICAgICAgICAgZW52OiBPYmplY3QuYXNzaWduKHsgTUVURU9SX1BSRVRUWV9PVVRQVVQ6IDAgfSwgcHJvY2Vzcy5lbnYpXG4gICAgICAgICAgICB9KS5vbignZXhpdCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwbGF0Zm9ybXMgPSBmcy5yZWFkRmlsZVN5bmModGhpcy4kLmVudi5wYXRocy5tZXRlb3JBcHAucGxhdGZvcm1zLCAnVVRGLTgnKTtcbiAgICAgICAgICAgICAgICBpZiAofnBsYXRmb3Jtcy5pbmRleE9mKHBsYXRmb3JtKSkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEp1c3QgY2hlY2tzIGZvciBpbmRleC5odG1sIGFuZCBwcm9ncmFtLmpzb24gZXhpc3RlbmNlLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIGlzQ29yZG92YUJ1aWxkUmVhZHkoKSB7XG4gICAgICAgIGlmICh0aGlzLmluZGV4SFRNTHN0cmF0ZWd5ID09PSB0aGlzLmluZGV4SFRNTFN0cmF0ZWdpZXMuSU5ERVhfRlJPTV9DT1JET1ZBX0JVSUxEKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kLnV0aWxzLmV4aXN0cyh0aGlzLiQuZW52LnBhdGhzLm1ldGVvckFwcC5jb3Jkb3ZhQnVpbGRJbmRleCkgJiZcbiAgICAgICAgICAgICAgICB0aGlzLiQudXRpbHMuZXhpc3RzKHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLmNvcmRvdmFCdWlsZFByb2dyYW1Kc29uKSAmJlxuICAgICAgICAgICAgICAgIChcbiAgICAgICAgICAgICAgICAgICAgIXRoaXMub2xkTWFuaWZlc3QgfHxcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMub2xkTWFuaWZlc3QgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2xkTWFuaWZlc3QgIT09IGZzLnJlYWRGaWxlU3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQuZW52LnBhdGhzLm1ldGVvckFwcC5jb3Jkb3ZhQnVpbGRQcm9ncmFtSnNvbiwgJ1VURi04JylcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuJC51dGlscy5leGlzdHModGhpcy4kLmVudi5wYXRocy5tZXRlb3JBcHAud2ViQ29yZG92YVByb2dyYW1Kc29uKSAmJlxuICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICF0aGlzLm9sZE1hbmlmZXN0IHx8XG4gICAgICAgICAgICAgICAgKHRoaXMub2xkTWFuaWZlc3QgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbGRNYW5pZmVzdCAhPT0gZnMucmVhZEZpbGVTeW5jKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kLmVudi5wYXRocy5tZXRlb3JBcHAud2ViQ29yZG92YVByb2dyYW1Kc29uLCAnVVRGLTgnKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2hlcyBpbmRleC5odG1sIGZyb20gcnVubmluZyBwcm9qZWN0LlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjwqPn1cbiAgICAgKi9cbiAgICBhc3luYyBhY3F1aXJlSW5kZXgoKSB7XG4gICAgICAgIGNvbnN0IHBvcnQgPSAodGhpcy4kLmVudi5vcHRpb25zLnBvcnQpID8gdGhpcy4kLmVudi5vcHRpb25zLnBvcnQgOiAzMDgwO1xuICAgICAgICB0aGlzLmxvZy5pbmZvKCdhY3F1aXJpbmcgaW5kZXguaHRtbCcpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgaHR0cDovLzEyNy4wLjAuMToke3BvcnR9L19fY29yZG92YS9pbmRleC5odG1sYCk7XG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgICAvLyBTaW1wbGUgdGVzdCBpZiB3ZSByZWFsbHkgZG93bmxvYWQgaW5kZXguaHRtbCBmb3Igd2ViLmNvcmRvdmEuXG4gICAgICAgIGlmICh+dGV4dC5pbmRleE9mKCdzcmM9XCIvY29yZG92YS5qc1wiJykpIHtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaGVzIG1haW5mZXN0Lmpzb24gZnJvbSBydW5uaW5nIHByb2plY3QuXG4gICAgICogQHJldHVybnMge1Byb21pc2UuPHZvaWQ+fVxuICAgICAqL1xuICAgIGFzeW5jIGFjcXVpcmVNYW5pZmVzdCgpIHtcbiAgICAgICAgY29uc3QgcG9ydCA9ICh0aGlzLiQuZW52Lm9wdGlvbnMucG9ydCkgPyB0aGlzLiQuZW52Lm9wdGlvbnMucG9ydCA6IDMwODA7XG4gICAgICAgIHRoaXMubG9nLmluZm8oJ2FjcXVpcmluZyBtYW5pZmVzdC5qc29uJyk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKFxuICAgICAgICAgICAgYGh0dHA6Ly8xMjcuMC4wLjE6JHtwb3J0fS9fX2NvcmRvdmEvbWFuaWZlc3QuanNvbj9tZXRlb3JfZG9udF9zZXJ2ZV9pbmRleD10cnVlYCk7XG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh0ZXh0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmllcyB0byBnZXQgYSBtb2JpbGUgYnVpbGQgZnJvbSBtZXRlb3IgYXBwLlxuICAgICAqIEluIGNhc2Ugb2YgZmFpbHVyZSBsZWF2ZXMgYSBtZXRlb3IubG9nLlxuICAgICAqIEEgbG90IG9mIHN0dWZmIGlzIGhhcHBlbmluZyBoZXJlIC0gYnV0IHRoZSBtYWluIGFpbSBpcyB0byBnZXQgYSBtb2JpbGUgYnVpbGQgZnJvbVxuICAgICAqIC5tZXRlb3IvbG9jYWwvY29yZG92YS1idWlsZC93d3cvYXBwbGljYXRpb24gYW5kIGV4aXQgYXMgc29vbiBhcyBwb3NzaWJsZS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGJ1aWxkTW9iaWxlVGFyZ2V0KCkge1xuICAgICAgICBjb25zdCBwcm9ncmFtSnNvbiA9XG4gICAgICAgICAgICAodGhpcy5pbmRleEhUTUxzdHJhdGVneSA9PT0gdGhpcy5pbmRleEhUTUxTdHJhdGVnaWVzLklOREVYX0ZST01fQ09SRE9WQV9CVUlMRCkgP1xuICAgICAgICAgICAgICAgIHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLmNvcmRvdmFCdWlsZFByb2dyYW1Kc29uIDpcbiAgICAgICAgICAgICAgICB0aGlzLiQuZW52LnBhdGhzLm1ldGVvckFwcC53ZWJDb3Jkb3ZhUHJvZ3JhbUpzb247XG5cbiAgICAgICAgaWYgKHRoaXMuJC51dGlscy5leGlzdHMocHJvZ3JhbUpzb24pKSB7XG4gICAgICAgICAgICB0aGlzLm9sZE1hbmlmZXN0ID0gZnMucmVhZEZpbGVTeW5jKHByb2dyYW1Kc29uLCAnVVRGLTgnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGxldCBsb2cgPSAnJztcbiAgICAgICAgICAgIGxldCBkZXNpcmVkRXhpdCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGJ1aWxkVGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgZXJyb3JUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlVGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICBsZXQga2lsbFRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgbGV0IGNvcmRvdmFDaGVja0ludGVydmFsID0gbnVsbDtcbiAgICAgICAgICAgIGxldCBwb3J0UHJvYmxlbSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB3aW5kb3dzS2lsbChwaWQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmxvZy5kZWJ1Zyhga2lsbGluZyBwaWQ6ICR7cGlkfWApO1xuICAgICAgICAgICAgICAgIHNwYXduLnN5bmMoJ3Rhc2traWxsJywgWycvcGlkJywgcGlkLCAnL2YnLCAnL3QnXSk7XG5cbiAgICAgICAgICAgICAgICAvLyBXZSB3aWxsIGxvb2sgZm9yIG90aGVyIHByb2Nlc3Mgd2hpY2ggbWlnaHQgaGF2ZSBiZWVuIGNyZWF0ZWQgb3V0c2lkZSB0aGVcbiAgICAgICAgICAgICAgICAvLyBwcm9jZXNzIHRyZWUuXG4gICAgICAgICAgICAgICAgLy8gTGV0cyBsaXN0IGFsbCBub2RlLmV4ZSBwcm9jZXNzZXMuXG4gICAgICAgICAgICAgICAgY29uc3Qgb3V0ID0gc3Bhd25cbiAgICAgICAgICAgICAgICAgICAgLnN5bmMoXG4gICAgICAgICAgICAgICAgICAgICAgICAnd21pYycsXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3Byb2Nlc3MnLCAnd2hlcmUnLCAnY2FwdGlvbj1cIm5vZGUuZXhlXCInLCAnZ2V0JywgJ2NvbW1hbmRsaW5lLHByb2Nlc3NpZCddKVxuICAgICAgICAgICAgICAgICAgICAuc3Rkb3V0LnRvU3RyaW5nKCd1dGYtOCcpXG4gICAgICAgICAgICAgICAgICAgIC5zcGxpdCgnXFxuJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgYXJncyA9IHNlbGYucHJlcGFyZUFyZ3VtZW50cygpO1xuICAgICAgICAgICAgICAgIC8vIExldHMgbW91bnQgcmVnZXguXG4gICAgICAgICAgICAgICAgY29uc3QgcmVnZXhWMSA9IG5ldyBSZWdFeHAoYCR7YXJncy5qb2luKCdcXFxccysnKX1cXFxccysoXFxcXGQrKWAsICdnbScpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2V4VjIgPSBuZXcgUmVnRXhwKGBcIiR7YXJncy5qb2luKCdcIlxcXFxzK1wiJyl9XCJcXFxccysoXFxcXGQrKWAsICdnbScpO1xuICAgICAgICAgICAgICAgIC8vIE5vIHdlIHdpbGwgY2hlY2sgZm9yIHRob3NlIHdpdGggdGhlIG1hdGNoaW5nIHBhcmFtcy5cbiAgICAgICAgICAgICAgICBvdXQuZm9yRWFjaCgobGluZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IHJlZ2V4VjEuZXhlYyhsaW5lKSB8fCByZWdleFYyLmV4ZWMobGluZSkgfHwgZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2cuZGVidWcoYGtpbGxpbmcgcGlkOiAke21hdGNoWzFdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3Bhd24uc3luYygndGFza2tpbGwnLCBbJy9waWQnLCBtYXRjaFsxXSwgJy9mJywgJy90J10pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHdyaXRlTG9nKCkge1xuICAgICAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMoJ21ldGVvci5sb2cnLCBsb2csICdVVEYtOCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBjbGVhclRpbWVvdXRzQW5kSW50ZXJ2YWxzKCkge1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoY29yZG92YUNoZWNrSW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChidWlsZFRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChlcnJvclRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChtZXNzYWdlVGltZW91dCk7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGtpbGxUaW1lb3V0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgYXJncyA9IHRoaXMucHJlcGFyZUFyZ3VtZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLmxvZy5pbmZvKGBydW5uaW5nIFwibWV0ZW9yICR7YXJncy5qb2luKCcgJyl9XCIuLi4gdGhpcyBtaWdodCB0YWtlIGEgd2hpbGVgKTtcblxuICAgICAgICAgICAgLy8gTGV0cyBzcGF3biBtZXRlb3IuXG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IHNwYXduKFxuICAgICAgICAgICAgICAgICdtZXRlb3InLFxuICAgICAgICAgICAgICAgIGFyZ3MsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBlbnY6IE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAgICAgICAgICAgICAgICB7IE1FVEVPUl9QUkVUVFlfT1VUUFVUOiAwLCBNRVRFT1JfTk9fUkVMRUFTRV9DSEVDSzogMSB9LCBwcm9jZXNzLmVudiksXG4gICAgICAgICAgICAgICAgICAgIGN3ZDogdGhpcy4kLmVudi5wYXRocy5tZXRlb3JBcHAucm9vdFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgeyBzaGVsbDogdHJ1ZSB9XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBLaWxscyB0aGUgY3VycmVudGx5IHJ1bm5pbmcgbWV0ZW9yIGNvbW1hbmQuXG4gICAgICAgICAgICBmdW5jdGlvbiBraWxsKCkge1xuICAgICAgICAgICAgICAgIHNsbCgnJyk7XG4gICAgICAgICAgICAgICAgY2hpbGQua2lsbCgnU0lHS0lMTCcpO1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLiQuZW52Lm9zLmlzV2luZG93cykge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3dzS2lsbChjaGlsZC5waWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXhpdCgpIHtcbiAgICAgICAgICAgICAgICBraWxsVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXRzQW5kSW50ZXJ2YWxzKCk7XG4gICAgICAgICAgICAgICAgICAgIGRlc2lyZWRFeGl0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAga2lsbCgpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gY29weUJ1aWxkKCkge1xuICAgICAgICAgICAgICAgIHNlbGYuY29weUJ1aWxkKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGV4aXQoKTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dHNBbmRJbnRlcnZhbHMoKTtcbiAgICAgICAgICAgICAgICAgICAga2lsbCgpO1xuICAgICAgICAgICAgICAgICAgICB3cml0ZUxvZygpO1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoJ2NvcHknKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29yZG92YUNoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgYWxyZWFkeSBoYXZlIGNvcmRvdmEtYnVpbGQgcmVhZHkuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDb3Jkb3ZhQnVpbGRSZWFkeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHNvLCB0aGVuIGV4aXQgaW1tZWRpYXRlbHkuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluZGV4SFRNTHN0cmF0ZWd5ID09PVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmRleEhUTUxTdHJhdGVnaWVzLklOREVYX0ZST01fQ09SRE9WQV9CVUlMRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29weUJ1aWxkKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDAwKTtcblxuICAgICAgICAgICAgY2hpbGQuc3RkZXJyLm9uKCdkYXRhJywgKGNodW5rKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGluZSA9IGNodW5rLnRvU3RyaW5nKCdVVEYtOCcpO1xuICAgICAgICAgICAgICAgIGxvZyArPSBgJHtsaW5lfVxcbmA7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yVGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoZXJyb3JUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRG8gbm90IGV4aXQgaWYgdGhpcyBpcyB0aGUgd2FybmluZyBmb3IgdXNpbmcgLS1wcm9kdWN0aW9uLlxuICAgICAgICAgICAgICAgIC8vIE91dHB1dCBleGNlZWRzIC0+IGh0dHBzOi8vZ2l0aHViLmNvbS9tZXRlb3IvbWV0ZW9yL2lzc3Vlcy84NTkyXG4gICAgICAgICAgICAgICAgaWYgKCF+bGluZS5pbmRleE9mKCctLXByb2R1Y3Rpb24nKSAmJiAhfmxpbmUuaW5kZXhPZignT3V0cHV0IGV4Y2VlZHMgJykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2Ugd2lsbCBleGl0IDFzIGFmdGVyIGxhc3QgZXJyb3IgaW4gc3RkZXJyLlxuICAgICAgICAgICAgICAgICAgICBlcnJvclRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dHNBbmRJbnRlcnZhbHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtpbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlTG9nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjaGlsZC5zdGRvdXQub24oJ2RhdGEnLCAoY2h1bmspID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gY2h1bmsudG9TdHJpbmcoJ1VURi04Jyk7XG4gICAgICAgICAgICAgICAgaWYgKCFkZXNpcmVkRXhpdCAmJiBsaW5lLnRyaW0oKS5yZXBsYWNlKC9bXFxuXFxyXFx0XFx2XFxmXSsvZ20sICcnKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGluZXNUb0Rpc3BsYXkgPSBsaW5lLnRyaW0oKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNwbGl0KCdcXG5cXHInKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBkaXNwbGF5IGxhc3QgbGluZSBmcm9tIHRoZSBjaHVuay5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FuaXRpemVkTGluZSA9IGxpbmVzVG9EaXNwbGF5LnBvcCgpLnJlcGxhY2UoL1tcXG5cXHJcXHRcXHZcXGZdKy9nbSwgJycpO1xuICAgICAgICAgICAgICAgICAgICBzbGwoc2FuaXRpemVkTGluZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxvZyArPSBgJHtsaW5lfVxcbmA7XG4gICAgICAgICAgICAgICAgaWYgKH5saW5lLmluZGV4T2YoJ2FmdGVyX3BsYXRmb3JtX2FkZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsbCgnJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmluZm8oJ2RvbmUuLi4gMTAlJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKH5saW5lLmluZGV4T2YoJ0xvY2FsIHBhY2thZ2UgdmVyc2lvbicpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlVGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1lc3NhZ2VUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2xsKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmluZm8oJ2J1aWxkaW5nIGluIHByb2dyZXNzLi4uJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDE1MDApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh+bGluZS5pbmRleE9mKCdQcmVwYXJpbmcgQ29yZG92YSBwcm9qZWN0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgc2xsKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cuaW5mbygnZG9uZS4uLiA2MCUnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAofmxpbmUuaW5kZXhPZignQ2FuXFwndCBsaXN0ZW4gb24gcG9ydCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvcnRQcm9ibGVtID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAofmxpbmUuaW5kZXhPZignWW91ciBhcHBsaWNhdGlvbiBoYXMgZXJyb3JzJykpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yVGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGVycm9yVGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZXJyb3JUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXRzQW5kSW50ZXJ2YWxzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBraWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUxvZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdlcnJvckluQXBwJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh+bGluZS5pbmRleE9mKCdBcHAgcnVubmluZyBhdCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvcHlCdWlsZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBXaGVuIE1ldGVvciBleGl0c1xuICAgICAgICAgICAgY2hpbGQub24oJ2V4aXQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2xsKCcnKTtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXRzQW5kSW50ZXJ2YWxzKCk7XG4gICAgICAgICAgICAgICAgaWYgKCFkZXNpcmVkRXhpdCkge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZUxvZygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocG9ydFByb2JsZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgncG9ydCcpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdleGl0Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYnVpbGRUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAga2lsbCgpO1xuICAgICAgICAgICAgICAgIHdyaXRlTG9nKCk7XG4gICAgICAgICAgICAgICAgcmVqZWN0KCd0aW1lb3V0Jyk7XG4gICAgICAgICAgICB9LCB0aGlzLiQuZW52Lm9wdGlvbnMuYnVpbGRUaW1lb3V0ID8gdGhpcy4kLmVudi5vcHRpb25zLmJ1aWxkVGltZW91dCAqIDEwMDAgOiA2MDAwMDApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlcyB0aGUgRERQIHVybCB0aGF0IHdhcyB1c2VkIG9yaWdpbmFsbHkgd2hlbiBNZXRlb3Igd2FzIGJ1aWxkaW5nIHRoZSBjbGllbnQuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGluZGV4SHRtbCAtIHBhdGggdG8gaW5kZXguaHRtbCBmcm9tIHRoZSBjbGllbnRcbiAgICAgKi9cbiAgICB1cGRhdGVEZHBVcmwoaW5kZXhIdG1sKSB7XG4gICAgICAgIGxldCBjb250ZW50O1xuICAgICAgICBsZXQgcnVudGltZUNvbmZpZztcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhpbmRleEh0bWwsICdVVEYtOCcpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgZXJyb3IgbG9hZGluZyBpbmRleC5odG1sIGZpbGU6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5tYXRjaGVyLnRlc3QoY29udGVudCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKCdjb3VsZCBub3QgZmluZCBydW50aW1lIGNvbmZpZyBpbiBpbmRleCBmaWxlJyk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2godGhpcy5tYXRjaGVyKTtcbiAgICAgICAgICAgIHJ1bnRpbWVDb25maWcgPSBKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudChtYXRjaGVzWzFdKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKCdjb3VsZCBub3QgZmluZCBydW50aW1lIGNvbmZpZyBpbiBpbmRleCBmaWxlJyk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy4kLmVudi5vcHRpb25zLmRkcFVybC5zdWJzdHIoLTEsIDEpICE9PSAnLycpIHtcbiAgICAgICAgICAgIHRoaXMuJC5lbnYub3B0aW9ucy5kZHBVcmwgKz0gJy8nO1xuICAgICAgICB9XG5cbiAgICAgICAgcnVudGltZUNvbmZpZy5ST09UX1VSTCA9IHRoaXMuJC5lbnYub3B0aW9ucy5kZHBVcmw7XG4gICAgICAgIHJ1bnRpbWVDb25maWcuRERQX0RFRkFVTFRfQ09OTkVDVElPTl9VUkwgPSB0aGlzLiQuZW52Lm9wdGlvbnMuZGRwVXJsO1xuXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoXG4gICAgICAgICAgICB0aGlzLnJlcGxhY2VyLCBgJDFcIiR7ZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KHJ1bnRpbWVDb25maWcpKX1cIiQzYCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMoaW5kZXhIdG1sLCBjb250ZW50KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoYGVycm9yIHdyaXRpbmcgaW5kZXguaHRtbCBmaWxlOiAke2UubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZy5pbmZvKCdzdWNjZXNzZnVsbHkgdXBkYXRlZCBkZHAgc3RyaW5nIGluIHRoZSBydW50aW1lIGNvbmZpZyBvZiBhIG1vYmlsZSBidWlsZCcgK1xuICAgICAgICAgICAgYCB0byAke3RoaXMuJC5lbnYub3B0aW9ucy5kZHBVcmx9YCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJlcGFyZXMgdGhlIGFyZ3VtZW50cyBwYXNzZWQgdG8gYG1ldGVvcmAgY29tbWFuZC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nW119XG4gICAgICovXG4gICAgcHJlcGFyZUFyZ3VtZW50cygpIHtcbiAgICAgICAgY29uc3QgYXJncyA9IFsncnVuJywgJy0tdmVyYm9zZScsIGAtLW1vYmlsZS1zZXJ2ZXI9JHt0aGlzLiQuZW52Lm9wdGlvbnMuZGRwVXJsfWBdO1xuICAgICAgICBpZiAodGhpcy4kLmVudi5pc1Byb2R1Y3Rpb25CdWlsZCgpKSB7XG4gICAgICAgICAgICBhcmdzLnB1c2goJy0tcHJvZHVjdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIGFyZ3MucHVzaCgnLXAnKTtcbiAgICAgICAgaWYgKHRoaXMuJC5lbnYub3B0aW9ucy5wb3J0KSB7XG4gICAgICAgICAgICBhcmdzLnB1c2godGhpcy4kLmVudi5vcHRpb25zLnBvcnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXJncy5wdXNoKCczMDgwJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJC5lbnYub3B0aW9ucy5tZXRlb3JTZXR0aW5ncykge1xuICAgICAgICAgICAgYXJncy5wdXNoKCctLXNldHRpbmdzJywgdGhpcy4kLmVudi5vcHRpb25zLm1ldGVvclNldHRpbmdzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJncztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZXMgdGhlIG1vYmlsZSBidWlsZCBhbmQgY29waWVzIGl0IGludG8gZWxlY3Ryb24gYXBwLlxuICAgICAqL1xuICAgIGFzeW5jIGNvcHlCdWlsZCgpIHtcbiAgICAgICAgdGhpcy5sb2cuZGVidWcoJ2NsZWFyaW5nIGJ1aWxkIGRpcicpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy4kLnV0aWxzLnJtV2l0aFJldHJpZXMoJy1yZicsIHRoaXMuJC5lbnYucGF0aHMuZWxlY3Ryb25BcHAubWV0ZW9yQXBwKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHByZWZpeCA9ICdjb3Jkb3ZhQnVpbGQnO1xuICAgICAgICBsZXQgY29weVBhdGhQb3N0Zml4ID0gJyc7XG5cbiAgICAgICAgaWYgKHRoaXMuaW5kZXhIVE1Mc3RyYXRlZ3kgPT09IHRoaXMuaW5kZXhIVE1MU3RyYXRlZ2llcy5JTkRFWF9GUk9NX1JVTk5JTkdfU0VSVkVSKSB7XG4gICAgICAgICAgICBwcmVmaXggPSAnd2ViQ29yZG92YSc7XG4gICAgICAgICAgICBjb3B5UGF0aFBvc3RmaXggPSBgJHtwYXRoLnNlcH0qYDtcbiAgICAgICAgICAgIGxldCBpbmRleEh0bWw7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGZzLm1rZGlyKHRoaXMuJC5lbnYucGF0aHMuZWxlY3Ryb25BcHAubWV0ZW9yQXBwKTtcbiAgICAgICAgICAgICAgICBpbmRleEh0bWwgPSBhd2FpdCB0aGlzLmFjcXVpcmVJbmRleCgpO1xuICAgICAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmModGhpcy4kLmVudi5wYXRocy5lbGVjdHJvbkFwcC5tZXRlb3JBcHBJbmRleCwgaW5kZXhIdG1sKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5pbmZvKCdzdWNjZXNzZnVsbHkgZG93bmxvYWRlZCBpbmRleC5odG1sIGZyb20gcnVubmluZyBtZXRlb3IgYXBwJyk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoJ2Vycm9yIHdoaWxlIHRyeWluZyB0byBkb3dubG9hZCBpbmRleC5odG1sIGZvciB3ZWIuY29yZG92YSwgJyArXG4gICAgICAgICAgICAgICAgICAgICdiZSBzdXJlIHRoYXQgeW91IGFyZSBydW5uaW5nIGEgbW9iaWxlIHRhcmdldCBvciB3aXRoJyArXG4gICAgICAgICAgICAgICAgICAgICcgLS1tb2JpbGUtc2VydmVyOiAnLCBlKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29yZG92YUJ1aWxkID0gdGhpcy4kLmVudi5wYXRocy5tZXRlb3JBcHBbcHJlZml4XTtcbiAgICAgICAgY29uc3QgY29yZG92YUJ1aWxkSW5kZXggPSB0aGlzLiQuZW52LnBhdGhzLm1ldGVvckFwcC5jb3Jkb3ZhQnVpbGRJbmRleDtcbiAgICAgICAgY29uc3QgY29yZG92YUJ1aWxkUHJvZ3JhbUpzb24gPSB0aGlzLiQuZW52LnBhdGhzLm1ldGVvckFwcFtgJHtwcmVmaXh9UHJvZ3JhbUpzb25gXTtcblxuICAgICAgICBpZiAoIXRoaXMuJC51dGlscy5leGlzdHMoY29yZG92YUJ1aWxkKSkge1xuICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoYG5vIG1vYmlsZSBidWlsZCBmb3VuZCBhdCAke2NvcmRvdmFCdWlsZH1gKTtcbiAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKCdhcmUgeW91IHN1cmUgeW91IGRpZCBydW4gbWV0ZW9yIHdpdGggLS1tb2JpbGUtc2VydmVyPycpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdyZXF1aXJlZCBmaWxlIG5vdCBwcmVzZW50Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuJC51dGlscy5leGlzdHMoY29yZG92YUJ1aWxkUHJvZ3JhbUpzb24pKSB7XG4gICAgICAgICAgICB0aGlzLmxvZy5lcnJvcignbm8gcHJvZ3JhbS5qc29uIGZvdW5kIGluIG1vYmlsZSBidWlsZCBmb3VuZCBhdCAnICtcbiAgICAgICAgICAgICAgICBgJHtjb3Jkb3ZhQnVpbGR9YCk7XG4gICAgICAgICAgICB0aGlzLmxvZy5lcnJvcignYXJlIHlvdSBzdXJlIHlvdSBkaWQgcnVuIG1ldGVvciB3aXRoIC0tbW9iaWxlLXNlcnZlcj8nKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncmVxdWlyZWQgZmlsZSBub3QgcHJlc2VudCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaW5kZXhIVE1Mc3RyYXRlZ3kgIT09IHRoaXMuaW5kZXhIVE1MU3RyYXRlZ2llcy5JTkRFWF9GUk9NX1JVTk5JTkdfU0VSVkVSKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuJC51dGlscy5leGlzdHMoY29yZG92YUJ1aWxkSW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoJ25vIGluZGV4Lmh0bWwgZm91bmQgaW4gY29yZG92YSBidWlsZCBmb3VuZCBhdCAnICtcbiAgICAgICAgICAgICAgICAgICAgYCR7Y29yZG92YUJ1aWxkfWApO1xuICAgICAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKCdhcmUgeW91IHN1cmUgeW91IGRpZCBydW4gbWV0ZW9yIHdpdGggLS1tb2JpbGUtc2VydmVyPycpO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncmVxdWlyZWQgZmlsZSBub3QgcHJlc2VudCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sb2cudmVyYm9zZSgnY29weWluZyBtb2JpbGUgYnVpbGQnKTtcbiAgICAgICAgc2hlbGwuY3AoXG4gICAgICAgICAgICAnLVInLCBgJHtjb3Jkb3ZhQnVpbGR9JHtjb3B5UGF0aFBvc3RmaXh9YCwgdGhpcy4kLmVudi5wYXRocy5lbGVjdHJvbkFwcC5tZXRlb3JBcHBcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBCZWNhdXNlIG9mIHZhcmlvdXMgcGVybWlzc2lvbiBwcm9ibGVtcyBoZXJlIHdlIHRyeSB0byBjbGVhciB0ZSBwYXRoIGJ5IGNsZWFyaW5nXG4gICAgICAgIC8vIGFsbCBwb3NzaWJsZSByZXN0cmljdGlvbnMuXG4gICAgICAgIHNoZWxsLmNobW9kKFxuICAgICAgICAgICAgJy1SJywgJzc3NycsIHRoaXMuJC5lbnYucGF0aHMuZWxlY3Ryb25BcHAubWV0ZW9yQXBwXG4gICAgICAgICk7XG4gICAgICAgIGlmICh0aGlzLiQuZW52Lm9zLmlzV2luZG93cykge1xuICAgICAgICAgICAgc2hlbGwuZXhlYyhgYXR0cmliIC1yICR7dGhpcy4kLmVudi5wYXRocy5lbGVjdHJvbkFwcC5tZXRlb3JBcHB9JHtwYXRoLnNlcH0qLiogL3NgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmluZGV4SFRNTHN0cmF0ZWd5ID09PSB0aGlzLmluZGV4SFRNTFN0cmF0ZWdpZXMuSU5ERVhfRlJPTV9SVU5OSU5HX1NFUlZFUikge1xuICAgICAgICAgICAgbGV0IHByb2dyYW1Kc29uO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBwcm9ncmFtSnNvbiA9IGF3YWl0IHRoaXMuYWNxdWlyZU1hbmlmZXN0KCk7XG4gICAgICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kLmVudi5wYXRocy5lbGVjdHJvbkFwcC5tZXRlb3JBcHBQcm9ncmFtSnNvbixcbiAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkocHJvZ3JhbUpzb24sIG51bGwsIDQpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5pbmZvKCdzdWNjZXNzZnVsbHkgZG93bmxvYWRlZCBtYW5pZmVzdC5qc29uIGZyb20gcnVubmluZyBtZXRlb3IgYXBwJyk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoJ2Vycm9yIHdoaWxlIHRyeWluZyB0byBkb3dubG9hZCBtYW5pZmVzdC5qc29uIGZvciB3ZWIuY29yZG92YSwnICtcbiAgICAgICAgICAgICAgICAgICAgJyBiZSBzdXJlIHRoYXQgeW91IGFyZSBydW5uaW5nIGEgbW9iaWxlIHRhcmdldCBvciB3aXRoJyArXG4gICAgICAgICAgICAgICAgICAgICcgLS1tb2JpbGUtc2VydmVyOiAnLCBlKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sb2cuaW5mbygnbW9iaWxlIGJ1aWxkIGNvcGllZCB0byBlbGVjdHJvbiBhcHAnKTtcblxuICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnY29weSBjb3Jkb3ZhLmpzIHRvIG1ldGVvciBidWlsZCcpO1xuICAgICAgICBzaGVsbC5jcChcbiAgICAgICAgICAgIGpvaW4oX19kaXJuYW1lLCAnLi4nLCAnc2tlbGV0b24nLCAnY29yZG92YS5qcycpLFxuICAgICAgICAgICAgdGhpcy4kLmVudi5wYXRocy5lbGVjdHJvbkFwcC5tZXRlb3JBcHBcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbmplY3RzIE1ldGVvci5pc0Rlc2t0b3BcbiAgICAgKi9cbiAgICBpbmplY3RJc0Rlc2t0b3AoKSB7XG4gICAgICAgIHRoaXMubG9nLmluZm8oJ2luamVjdGluZyBpc0Rlc2t0b3AnKTtcblxuICAgICAgICBsZXQgbWFuaWZlc3RKc29uUGF0aCA9IHRoaXMuJC5lbnYucGF0aHMubWV0ZW9yQXBwLmNvcmRvdmFCdWlsZFByb2dyYW1Kc29uO1xuICAgICAgICBpZiAodGhpcy5pbmRleEhUTUxzdHJhdGVneSA9PT0gdGhpcy5pbmRleEhUTUxTdHJhdGVnaWVzLklOREVYX0ZST01fUlVOTklOR19TRVJWRVIpIHtcbiAgICAgICAgICAgIG1hbmlmZXN0SnNvblBhdGggPSB0aGlzLiQuZW52LnBhdGhzLm1ldGVvckFwcC53ZWJDb3Jkb3ZhUHJvZ3JhbUpzb247XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbWFuaWZlc3QgPSBKU09OLnBhcnNlKFxuICAgICAgICAgICAgICAgIGZzLnJlYWRGaWxlU3luYyhtYW5pZmVzdEpzb25QYXRoLCAnVVRGLTgnKVxuICAgICAgICAgICAgKS5tYW5pZmVzdDtcbiAgICAgICAgICAgIGxldCBpbmplY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGluamVjdGVkU3RhcnR1cERpZENvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gV2Ugd2lsbCBzZWFyY2ggaW4gZXZlcnkgLmpzIGZpbGUgaW4gdGhlIG1hbmlmZXN0LlxuICAgICAgICAgICAgLy8gV2UgY291bGQgcHJvYmFibHkgZGV0ZWN0IHdoZXRoZXIgdGhpcyBpcyBhIGRldiBvciBwcm9kdWN0aW9uIGJ1aWxkIGFuZCBvbmx5IHNlYXJjaCBpblxuICAgICAgICAgICAgLy8gdGhlIGNvcnJlY3QgZmlsZXMsIGJ1dCBmb3Igbm93IHRoaXMgc2hvdWxkIGJlIGZpbmUuXG4gICAgICAgICAgICBtYW5pZmVzdC5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGZpbGVDb250ZW50cztcbiAgICAgICAgICAgICAgICAvLyBIYWNreSB3YXkgb2Ygc2V0dGluZyBpc0Rlc2t0b3AuXG4gICAgICAgICAgICAgICAgaWYgKGZpbGUudHlwZSA9PT0gJ2pzJykge1xuICAgICAgICAgICAgICAgICAgICBmaWxlQ29udGVudHMgPSBmcy5yZWFkRmlsZVN5bmMoXG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luKHRoaXMuJC5lbnYucGF0aHMuZWxlY3Ryb25BcHAubWV0ZW9yQXBwLCBmaWxlLnBhdGgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1VURi04J1xuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLmluamVjdG9yLnByb2Nlc3NGaWxlQ29udGVudHMoZmlsZUNvbnRlbnRzKTtcblxuICAgICAgICAgICAgICAgICAgICBmaWxlQ29udGVudHMgPSByZXN1bHQuZmlsZUNvbnRlbnRzO1xuICAgICAgICAgICAgICAgICAgICBpbmplY3RlZFN0YXJ0dXBEaWRDb21wbGV0ZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuaW5qZWN0ZWRTdGFydHVwRGlkQ29tcGxldGUgPyB0cnVlIDogaW5qZWN0ZWRTdGFydHVwRGlkQ29tcGxldGU7XG4gICAgICAgICAgICAgICAgICAgIGluamVjdGVkID0gcmVzdWx0LmluamVjdGVkID8gdHJ1ZSA6IGluamVjdGVkO1xuXG4gICAgICAgICAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMoXG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luKHRoaXMuJC5lbnYucGF0aHMuZWxlY3Ryb25BcHAubWV0ZW9yQXBwLCBmaWxlLnBhdGgpLCBmaWxlQ29udGVudHNcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCFpbmplY3RlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKCdlcnJvciBpbmplY3RpbmcgaXNEZXNrdG9wIGdsb2JhbCB2YXIuJyk7XG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFpbmplY3RlZFN0YXJ0dXBEaWRDb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKCdlcnJvciBpbmplY3RpbmcgaXNEZXNrdG9wIGZvciBzdGFydHVwRGlkQ29tcGxldGUnKTtcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKCdlcnJvciBvY2N1cnJlZCB3aGlsZSBpbmplY3RpbmcgaXNEZXNrdG9wOiAnLCBlKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZy5pbmZvKCdpbmplY3RlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZHMsIG1vZGlmaWVzIGFuZCBjb3BpZXMgdGhlIG1ldGVvciBhcHAgdG8gZWxlY3Ryb24gYXBwLlxuICAgICAqL1xuICAgIGFzeW5jIGJ1aWxkKCkge1xuICAgICAgICB0aGlzLmxvZy5pbmZvKCdjaGVja2luZyBmb3IgYW55IG1vYmlsZSBwbGF0Zm9ybScpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jaGVja1ByZWNvbmRpdGlvbnMoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoJ2Vycm9yIG9jY3VycmVkIGR1cmluZyBjaGVja2luZyBwcmVjb25kaXRpb25zOiAnLCBlKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubG9nLmluZm8oJ2J1aWxkaW5nIG1ldGVvciBhcHAnKTtcblxuICAgICAgICBpZiAoIXRoaXMuJC5lbnYub3B0aW9ucy5za2lwTW9iaWxlQnVpbGQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5idWlsZE1vYmlsZVRhcmdldCgpO1xuICAgICAgICAgICAgfSBjYXRjaCAocmVhc29uKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChyZWFzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndGltZW91dCc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGltZW91dCB3aGlsZSBidWlsZGluZywgbG9nIGhhcyBiZWVuIHdyaXR0ZW4gdG8gbWV0ZW9yLmxvZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Vycm9yJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb21lIGVycm9ycyB3ZXJlIHJlcG9ydGVkIGR1cmluZyBidWlsZCwgY2hlY2sgbWV0ZW9yLmxvZyBmb3IgbW9yZScgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgaW5mbycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Vycm9ySW5BcHAnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3lvdXIgbWV0ZW9yIGFwcCBoYXMgZXJyb3JzIC0gbG9vayBpbnRvIG1ldGVvci5sb2cgZm9yIG1vcmUnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIGluZm8nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdwb3J0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICd5b3VyIHBvcnQgMzA4MCBpcyBjdXJyZW50bHkgdXNlZCAoeW91IHByb2JhYmx5IGhhdmUgdGhpcyBvciBvdGhlciAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWV0ZW9yIHByb2plY3QgcnVubmluZz8pLCB1c2UgYC10YCBvciBgLS1tZXRlb3ItcG9ydGAgdG8gdXNlICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaWZmZXJlbnQgcG9ydCB3aGlsZSBidWlsZGluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2V4aXQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGVvciBjbWQgZXhpdGVkIHVuZXhwZWN0ZWRseSwgbG9nIGhhcyBiZWVuIHdyaXR0ZW4gdG8gbWV0ZW9yLmxvZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NvcHknOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yIGVuY291bnRlcmVkIHdoZW4gY29weWluZyB0aGUgYnVpbGQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoJ2Vycm9yIG9jY3VycmVkIGR1cmluZyBidWlsZGluZyBtb2JpbGUgdGFyZ2V0JywgcmVhc29uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9iaWxlUGxhdGZvcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5yZW1vdmVNb2JpbGVQbGF0Zm9ybSh0aGlzLm1vYmlsZVBsYXRmb3JtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbmRleEhUTUxzdHJhdGVneSA9IHRoaXMuY2hvb3NlU3RyYXRlZ3koKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb3B5QnVpbGQoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmluamVjdElzRGVza3RvcCgpO1xuXG4gICAgICAgIHRoaXMuY2hhbmdlRGRwVXJsKCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGFja1RvQXNhcigpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aGlzLmxvZy5lcnJvcignZXJyb3Igd2hpbGUgcGFja2luZyBtZXRlb3IgYXBwIHRvIGFzYXInKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubG9nLmluZm8oJ21ldGVvciBidWlsZCBmaW5pc2hlZCcpO1xuXG4gICAgICAgIGlmICh0aGlzLm1vYmlsZVBsYXRmb3JtKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJlbW92ZU1vYmlsZVBsYXRmb3JtKHRoaXMubW9iaWxlUGxhdGZvcm0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2hhbmdlRGRwVXJsKCkge1xuICAgICAgICBpZiAodGhpcy4kLmVudi5vcHRpb25zLmRkcFVybCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURkcFVybCh0aGlzLiQuZW52LnBhdGhzLmVsZWN0cm9uQXBwLm1ldGVvckFwcEluZGV4KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgZXJyb3Igd2hpbGUgdHJ5aW5nIHRvIGNoYW5nZSB0aGUgZGRwIHVybDogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwYWNrVG9Bc2FyKCkge1xuICAgICAgICB0aGlzLmxvZy5pbmZvKCdwYWNraW5nIG1ldGVvciBhcHAgdG8gYXNhciBhcmNoaXZlJyk7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PlxuICAgICAgICAgICAgYXNhci5jcmVhdGVQYWNrYWdlKFxuICAgICAgICAgICAgICAgIHRoaXMuJC5lbnYucGF0aHMuZWxlY3Ryb25BcHAubWV0ZW9yQXBwLFxuICAgICAgICAgICAgICAgIHBhdGguam9pbih0aGlzLiQuZW52LnBhdGhzLmVsZWN0cm9uQXBwLnJvb3QsICdtZXRlb3IuYXNhcicpLFxuICAgICAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT24gV2luZG93cyBzb21lIGZpbGVzIG1pZ2h0IHN0aWxsIGJlIGJsb2NrZWQuIEdpdmluZyBhIHRpY2sgZm9yIHRoZW0gdG8gYmVcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVhZHkgZm9yIGRlbGV0aW9uLlxuICAgICAgICAgICAgICAgICAgICBzZXRJbW1lZGlhdGUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cudmVyYm9zZSgnY2xlYXJpbmcgbWV0ZW9yIGFwcCBhZnRlciBwYWNraW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQudXRpbHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucm1XaXRoUmV0cmllcygnLXJmJywgdGhpcy4kLmVudi5wYXRocy5lbGVjdHJvbkFwcC5tZXRlb3JBcHApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxufVxuIl19